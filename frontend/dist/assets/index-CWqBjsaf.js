var ke=Object.defineProperty;var Be=(d,l,u)=>l in d?ke(d,l,{enumerable:!0,configurable:!0,writable:!0,value:u}):d[l]=u;var B=(d,l,u)=>Be(d,typeof l!="symbol"?l+"":l,u);/* empty css              */import{o as ce,s as A,a as H,M as b,B as Ae,P as de,p as Se,q as Te,t as Pe,v as Ee,T as $e,n as qe,w as Me,u as pe,x as De,y as ze,D as Le,_ as je,z as Re,A as He,E as Ne}from"./index-fDEUsWmJ.js";import{g as te,a as fe,r as Ve,b as Qe,c as Oe,u as O,d as Ke,e as We,f as Ze,h as Ye}from"./useFolderLevelTree-CDJ_26ol.js";import{g as Ge}from"./validate-BSUe8xyQ.js";/* empty css              *//* empty css              *//* empty css              */import{u as ae,a as he,b as me,c as _e}from"./file-Bu8a5mjb.js";/* empty css              */import{d as Xe,m as X}from"./menuData-B28-nopt.js";import{d as W,q as R,r as L,w as Je,h as f,b as U,i as $,j as y,k as r,$ as h,l as Y,z as V,e as S,N as se,O as ne,C as j,B as q,A as J,f as G,F as Q,G as oe,c as z,P as re,T as et,Y as tt,y as at}from"./vue-office_docx-BTzFQIdC.js";import{c as ee}from"./calc-CYjR0slx.js";import{_ as st}from"./logo.vue_vue_type_script_setup_true_lang-DPWU2qmp.js";import{H as nt}from"./index-DeLZq7_u.js";import"./useBreadcrumb-DKPyaTjD.js";import"./vue-office_excel-HlhG_4Om.js";import"./vue-office_pdf-1kjn8M9t.js";import"./vue-office_pptx-Ci_UBxwQ.js";const ot=d=>ce({url:"/updateUserInfo",method:"post",data:d}),rt=d=>ce({url:"/updateHomePassword",method:"post",data:d});var lt={exports:{}};(function(d,l){(function(u){d.exports=u()})(function(u){var c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function p(o,n){var e=o[0],t=o[1],s=o[2],a=o[3];e+=(t&s|~t&a)+n[0]-680876936|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[1]-389564586|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[2]+606105819|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[3]-1044525330|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&a)+n[4]-176418897|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[5]+1200080426|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[6]-1473231341|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[7]-45705983|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&a)+n[8]+1770035416|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[9]-1958414417|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[10]-42063|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[11]-1990404162|0,t=(t<<22|t>>>10)+s|0,e+=(t&s|~t&a)+n[12]+1804603682|0,e=(e<<7|e>>>25)+t|0,a+=(e&t|~e&s)+n[13]-40341101|0,a=(a<<12|a>>>20)+e|0,s+=(a&e|~a&t)+n[14]-1502002290|0,s=(s<<17|s>>>15)+a|0,t+=(s&a|~s&e)+n[15]+1236535329|0,t=(t<<22|t>>>10)+s|0,e+=(t&a|s&~a)+n[1]-165796510|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[6]-1069501632|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[11]+643717713|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[0]-373897302|0,t=(t<<20|t>>>12)+s|0,e+=(t&a|s&~a)+n[5]-701558691|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[10]+38016083|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[15]-660478335|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[4]-405537848|0,t=(t<<20|t>>>12)+s|0,e+=(t&a|s&~a)+n[9]+568446438|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[14]-1019803690|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[3]-187363961|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[8]+1163531501|0,t=(t<<20|t>>>12)+s|0,e+=(t&a|s&~a)+n[13]-1444681467|0,e=(e<<5|e>>>27)+t|0,a+=(e&s|t&~s)+n[2]-51403784|0,a=(a<<9|a>>>23)+e|0,s+=(a&t|e&~t)+n[7]+1735328473|0,s=(s<<14|s>>>18)+a|0,t+=(s&e|a&~e)+n[12]-1926607734|0,t=(t<<20|t>>>12)+s|0,e+=(t^s^a)+n[5]-378558|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[8]-2022574463|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[11]+1839030562|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[14]-35309556|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^a)+n[1]-1530992060|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[4]+1272893353|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[7]-155497632|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[10]-1094730640|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^a)+n[13]+681279174|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[0]-358537222|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[3]-722521979|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[6]+76029189|0,t=(t<<23|t>>>9)+s|0,e+=(t^s^a)+n[9]-640364487|0,e=(e<<4|e>>>28)+t|0,a+=(e^t^s)+n[12]-421815835|0,a=(a<<11|a>>>21)+e|0,s+=(a^e^t)+n[15]+530742520|0,s=(s<<16|s>>>16)+a|0,t+=(s^a^e)+n[2]-995338651|0,t=(t<<23|t>>>9)+s|0,e+=(s^(t|~a))+n[0]-198630844|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[7]+1126891415|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[14]-1416354905|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[5]-57434055|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~a))+n[12]+1700485571|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[3]-1894986606|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[10]-1051523|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[1]-2054922799|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~a))+n[8]+1873313359|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[15]-30611744|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[6]-1560198380|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[13]+1309151649|0,t=(t<<21|t>>>11)+s|0,e+=(s^(t|~a))+n[4]-145523070|0,e=(e<<6|e>>>26)+t|0,a+=(t^(e|~s))+n[11]-1120210379|0,a=(a<<10|a>>>22)+e|0,s+=(e^(a|~t))+n[2]+718787259|0,s=(s<<15|s>>>17)+a|0,t+=(a^(s|~e))+n[9]-343485551|0,t=(t<<21|t>>>11)+s|0,o[0]=e+o[0]|0,o[1]=t+o[1]|0,o[2]=s+o[2]|0,o[3]=a+o[3]|0}function m(o){var n=[],e;for(e=0;e<64;e+=4)n[e>>2]=o.charCodeAt(e)+(o.charCodeAt(e+1)<<8)+(o.charCodeAt(e+2)<<16)+(o.charCodeAt(e+3)<<24);return n}function _(o){var n=[],e;for(e=0;e<64;e+=4)n[e>>2]=o[e]+(o[e+1]<<8)+(o[e+2]<<16)+(o[e+3]<<24);return n}function g(o){var n=o.length,e=[1732584193,-271733879,-1732584194,271733878],t,s,a,v,T,E;for(t=64;t<=n;t+=64)p(e,m(o.substring(t-64,t)));for(o=o.substring(t-64),s=o.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<s;t+=1)a[t>>2]|=o.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(p(e,a),t=0;t<16;t+=1)a[t]=0;return v=n*8,v=v.toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(v[2],16),E=parseInt(v[1],16)||0,a[14]=T,a[15]=E,p(e,a),e}function x(o){var n=o.length,e=[1732584193,-271733879,-1732584194,271733878],t,s,a,v,T,E;for(t=64;t<=n;t+=64)p(e,_(o.subarray(t-64,t)));for(o=t-64<n?o.subarray(t-64):new Uint8Array(0),s=o.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;t<s;t+=1)a[t>>2]|=o[t]<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(p(e,a),t=0;t<16;t+=1)a[t]=0;return v=n*8,v=v.toString(16).match(/(.*?)(.{0,8})$/),T=parseInt(v[2],16),E=parseInt(v[1],16)||0,a[14]=T,a[15]=E,p(e,a),e}function w(o){var n="",e;for(e=0;e<4;e+=1)n+=c[o>>e*8+4&15]+c[o>>e*8&15];return n}function k(o){var n;for(n=0;n<o.length;n+=1)o[n]=w(o[n]);return o.join("")}k(g("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function o(n,e){return n=n|0||0,n<0?Math.max(n+e,0):Math.min(n,e)}ArrayBuffer.prototype.slice=function(n,e){var t=this.byteLength,s=o(n,t),a=t,v,T,E,Z;return e!==u&&(a=o(e,t)),s>a?new ArrayBuffer(0):(v=a-s,T=new ArrayBuffer(v),E=new Uint8Array(T),Z=new Uint8Array(this,s,v),E.set(Z),T)}}();function I(o){return/[\u0080-\uFFFF]/.test(o)&&(o=unescape(encodeURIComponent(o))),o}function P(o,n){var e=o.length,t=new ArrayBuffer(e),s=new Uint8Array(t),a;for(a=0;a<e;a+=1)s[a]=o.charCodeAt(a);return n?s:t}function D(o){return String.fromCharCode.apply(null,new Uint8Array(o))}function M(o,n,e){var t=new Uint8Array(o.byteLength+n.byteLength);return t.set(new Uint8Array(o)),t.set(new Uint8Array(n),o.byteLength),t}function C(o){var n=[],e=o.length,t;for(t=0;t<e-1;t+=2)n.push(parseInt(o.substr(t,2),16));return String.fromCharCode.apply(String,n)}function i(){this.reset()}return i.prototype.append=function(o){return this.appendBinary(I(o)),this},i.prototype.appendBinary=function(o){this._buff+=o,this._length+=o.length;var n=this._buff.length,e;for(e=64;e<=n;e+=64)p(this._hash,m(this._buff.substring(e-64,e)));return this._buff=this._buff.substring(e-64),this},i.prototype.end=function(o){var n=this._buff,e=n.length,t,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(t=0;t<e;t+=1)s[t>>2]|=n.charCodeAt(t)<<(t%4<<3);return this._finish(s,e),a=k(this._hash),o&&(a=C(a)),this.reset(),a},i.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},i.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},i.prototype.setState=function(o){return this._buff=o.buff,this._length=o.length,this._hash=o.hash,this},i.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},i.prototype._finish=function(o,n){var e=n,t,s,a;if(o[e>>2]|=128<<(e%4<<3),e>55)for(p(this._hash,o),e=0;e<16;e+=1)o[e]=0;t=this._length*8,t=t.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(t[2],16),a=parseInt(t[1],16)||0,o[14]=s,o[15]=a,p(this._hash,o)},i.hash=function(o,n){return i.hashBinary(I(o),n)},i.hashBinary=function(o,n){var e=g(o),t=k(e);return n?C(t):t},i.ArrayBuffer=function(){this.reset()},i.ArrayBuffer.prototype.append=function(o){var n=M(this._buff.buffer,o),e=n.length,t;for(this._length+=o.byteLength,t=64;t<=e;t+=64)p(this._hash,_(n.subarray(t-64,t)));return this._buff=t-64<e?new Uint8Array(n.buffer.slice(t-64)):new Uint8Array(0),this},i.ArrayBuffer.prototype.end=function(o){var n=this._buff,e=n.length,t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s,a;for(s=0;s<e;s+=1)t[s>>2]|=n[s]<<(s%4<<3);return this._finish(t,e),a=k(this._hash),o&&(a=C(a)),this.reset(),a},i.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},i.ArrayBuffer.prototype.getState=function(){var o=i.prototype.getState.call(this);return o.buff=D(o.buff),o},i.ArrayBuffer.prototype.setState=function(o){return o.buff=P(o.buff,!0),i.prototype.setState.call(this,o)},i.ArrayBuffer.prototype.destroy=i.prototype.destroy,i.ArrayBuffer.prototype._finish=i.prototype._finish,i.ArrayBuffer.hash=function(o,n){var e=x(new Uint8Array(o)),t=k(e);return n?C(t):t},i})})(lt);function le(d){return new Worker("/assets/calcMD5Worker-CUUhYSGC.js",{name:d==null?void 0:d.name})}const{isTree:ut,breadcrumbs:ue}=A(ae()),{updateFileItem:it}=he(),{updateTreeData:ct}=me(),{uploadFileList:dt}=A(_e()),{updateUserInfo:pt}=H(),ve=Xe(()=>{b.success("上传成功"),ut.value?ct():it(),pt()});async function ft(d){const{md5:l}=d,u=d.fileItem.file,c=new FormData;c.append("file",u),c.append("filename",u.name+""),c.append("md5",l),c.append("totalSize",u.size+""),c.append("pid",d.pid),c.append("category",te(u.name)),c.append("mediaType",fe(u.name));try{const p=await Ve(c);p.code===200?(d.status="finish",ve(),d.uploadedChunkIndexs.push(0)):(d.status="error",b.error(p.message))}catch{d.status="error",b.error("上传失败")}}function ye(d){const l=[];let u=0;for(;u<d.size;){const c=d.slice(u,u+K.CHUNK_SIZE);l.push(new Blob([c],{type:d.type})),u+=K.CHUNK_SIZE}return l}class ht{constructor(l,u=[]){B(this,"jobs");B(this,"currTask");B(this,"stopFlag");B(this,"executeCount");this.jobs=u,this.currTask=null,this.stopFlag=!1,this.executeCount=0}addTask(l){this.jobs.push(l)}get queue(){return this.jobs}async start(){var u;const l=[];this.currTask=async c=>{var m;if(this.stopFlag)return;this.stopFlag=!1,await c(),this.executeCount+=1;const p=this.jobs.shift();p&&l.push((m=this.currTask)==null?void 0:m.call(this,p))};for(let c=0;c<5;c++){const p=this.jobs.shift();p&&l.push((u=this.currTask)==null?void 0:u.call(this,p))}await Promise.all(l)}stop(){this.stopFlag=!0}}class K{constructor(l){B(this,"showedTip");B(this,"chunks");B(this,"controller");B(this,"reqQueue");B(this,"item");B(this,"uploadedChunkIndexes");B(this,"options");B(this,"category");B(this,"mediaType");this.showedTip=!1,this.controller=new AbortController,this.item=dt.value[l.index],this.reqQueue=new ht(this.item),this.uploadedChunkIndexes=this.item.uploadedChunkIndexs,this.chunks=ye(this.item.fileItem.file),this.options=l,this.category=te(this.item.fileItem.name??""),this.mediaType=fe(this.item.fileItem.name??"")}async prepareReqs(){const{item:l,chunks:u,controller:c}=this,{md5:p,fileItem:m}=l,{file:_}=m;this.chunks.forEach((g,x)=>{if(this.uploadedChunkIndexes.includes(x))return;const w=new FormData;w.append("file",g),w.append("filename",_.name+""),w.append("chunkIndex",x.toString()),w.append("totalChunkNum",u.length+""),w.append("totalSize",_.size+""),w.append("pid",l.pid),w.append("md5",p),w.append("category",this.category),this.reqQueue.addTask((k=x)=>Qe(w,c.signal).then(I=>{if(I.code===200)l.uploadedChunkIndexs.push(k);else{if(this.reqQueue.stop(),l.status==="pause")return;throw!this.showedTip&&b.error(I.message),this.showedTip=!0,new Error(I.message)}return I}).catch(()=>{this.reqQueue.stop(),l.status!=="pause"&&(l.status="error",!this.showedTip&&b.error("上传失败"))}))})}async upload(){await this.prepareReqs(),await this.reqQueue.start(),this.reqQueue.stopFlag||await this.merge()}async merge(){const{item:l,category:u,mediaType:c}=this,p=l.fileItem.file,m=p.name;await Oe({filename:m,pid:ue.value[ue.value.length-1].id,md5:l.md5,totalSize:p.size,totalChunkNum:this.chunks.length,category:u,mediaType:c}),l.status="finish",ve()}}B(K,"CHUNK_SIZE",10*1024*1024);const mt=10;async function _t(d){const l=Array.from({length:mt}).map(()=>new le),u=[],c=m=>new Promise(async _=>{const g=d.shift();g?(m.postMessage({type:"start",file:await g.arrayBuffer()}),m.onmessage=x=>{_(x.data.md5),u.push(c(m))}):_("")});for(const m of l)u.push(c(m));const p=(await Promise.all(u)).filter(m=>m.length);return p.length===1?p[0]:new Promise(async m=>{const _=new le;_.postMessage({type:"start",file:await new Blob(p,{type:"text/plain"}).arrayBuffer()}),_.onmessage=g=>{m(g.data.md5)}})}const vt={class:"w-56 truncate"},yt={class:"w-64 truncate flex items-center"},gt={class:"flex"},wt=W({__name:"upload-file-card",setup(d){const{isTree:l}=A(ae()),{updateTreeData:u}=me(),{uploadFileList:c}=A(_e()),{updateFileItem:p}=he(),{updateUserInfo:m}=H(),{iconColor:_,Icons:g}=A(O()),{userInfo:x}=A(H()),w=R(()=>({color:_.value,backgroundColor:"transparent"})),k=R(()=>{const e=[];return c.value.map(t=>e.unshift(t)),e}),I=async(e,t)=>{const s=c.value[t],a=ye(e.file);s.totalChunks=a.length;const v=await _t(a);s.md5=v,await o(s)},P=e=>e.fileItem.file.size>K.CHUNK_SIZE,D=L([]);Je(c,async e=>{e.forEach(async t=>{D.value.includes(t.fileItem.uid)||(D.value.push(t.fileItem.uid),t.status="parse",await I(t.fileItem,t.index))})},{deep:!0});const M={parse:"正在解析",upload:"正在上传",finish:"上传完成",pause:"暂停上传",error:"上传出错"},C=async e=>{const t=()=>{c.value.splice(e.index,1),c.value.forEach((s,a)=>s.index=a)};if(e.uploadedChunkIndexs.length<e.totalChunks)try{const s=await We({md5:e.md5,chunkIndexes:[...e.uploadedChunkIndexs],category:te(e.fileItem.name??"")});s.code===200?t():b.error(s.message)}catch{b.error("删除失败")}else t()},i=e=>{e.status="pause";const t=e.uploader;t==null||t.controller.abort(),t==null||t.reqQueue.stop()},o=async e=>{var s;e.status="upload";let t={uploaded:!1,indexes:[]};if(x.value.totalSpace-x.value.usedSpace<(((s=e.fileItem.file)==null?void 0:s.size)??0)){b.error("上传失败，空间不足"),c.value=c.value.filter(a=>a.fileItem.uid!==e.fileItem.uid);return}try{const a=await Ze(e.md5);a.code===200&&(t=a.data)}catch{}if(t.uploaded)Ye(e).then(a=>{a.code===200?(e.uploadedChunkIndexs=[0],e.totalChunks=1,e.status="finish",l.value?u():p(),m(),b.success("上传成功，已启用秒传")):b.error(a.message)}).catch(a=>b.error(a));else if(e.uploadedChunkIndexs=[...new Set([...e.uploadedChunkIndexs,...t.indexes])],P(e)){const a=new K(e);e.uploader=a,await a.upload()}else await ft(e)},n=()=>{for(let e=c.value.length-1;e>=0;e--)c.value[e].status==="finish"&&c.value.splice(e,1);b.success("清空成功")};return(e,t)=>{const s=f("IconSwap"),a=Ae,v=de,T=Se,E=f("icon-pause-circle"),Z=f("icon-play-arrow"),ge=f("icon-refresh"),we=f("icon-delete"),be=Te,Ce=Pe,xe=Ee,Ie=$e,Fe=qe,Ue=Me;return U(),$(Ue,{trigger:"click","unmount-on-close":!1},{content:y(()=>[r(Fe,{title:"文件上传管理",style:{width:"400px","max-width":"100vw","max-height":"600px",overflow:"auto",border:"2px solid #ddd","border-radius":"6px","box-shadow":"0 0 2px #ddd"}},{extra:y(()=>[h(c).length?(U(),$(Ie,{key:0,content:"清空已上传文件"},{default:y(()=>[(U(),$(Y(h(g).deleteCompletely),{class:"cursor-pointer",onClick:n}))]),_:1})):V("",!0)]),default:y(()=>[r(xe,{bordered:!1,data:h(k)},{item:y(({item:F})=>[r(Ce,{style:{width:"360px",padding:"3px"}},{actions:y(()=>[S("div",gt,[se(r(a,{shape:"round",type:"text"},{icon:y(()=>[F.status==="upload"?(U(),$(E,{key:0,onClick:N=>i(F)},null,8,["onClick"])):V("",!0),F.status==="pause"?(U(),$(Z,{key:1,onClick:N=>o(F)},null,8,["onClick"])):V("",!0)]),_:2},1536),[[ne,["upload","pause"].includes(F.status)]]),se(r(a,{shape:"round",type:"text",onClick:N=>o(F)},{icon:y(()=>[r(ge)]),_:2},1032,["onClick"]),[[ne,F.status==="error"]]),["pause","finish","error"].includes(F.status)?(U(),$(be,{key:0,type:"warning",position:"lb",content:"确定要删除吗？",onOk:N=>C(F)},{default:y(()=>[r(a,{shape:"round",type:"text"},{icon:y(()=>[r(we)]),_:1})]),_:2},1032,["onOk"])):V("",!0)])]),default:y(()=>[r(T,null,{avatar:y(()=>[(U(),$(Y(h(Ke)(F.fileItem.name)),{class:"scale-150 max-w-20"}))]),title:y(()=>[S("div",vt,j(F.fileItem.name),1)]),description:y(()=>{var N;return[q(" 位置："+j(F.level)+" / ",1),S("div",yt,[q(j(h(ee)(((N=F.fileItem.file)==null?void 0:N.size)??""))+"  ",1),S("span",{class:J(`${F.status==="error"?"text-[red]":F.status==="finish"?"text-[green]":""}`)},j(M[F.status]),3)]),r(v,{percision:2,style:{width:"260px"},percent:+(F.uploadedChunkIndexs.length/F.totalChunks).toFixed(3)},null,8,["percent"])]}),_:2},1024)]),_:2},1024)]),_:1},8,["data"])]),_:1})]),default:y(()=>[r(a,{shape:"circle",size:"large",class:"mr-1",style:G(h(w))},{icon:y(()=>[r(s,{rotate:90,class:"scale-125",size:20})]),_:1},8,["style"])]),_:1})}}}),bt={nickname:[{required:!0,message:"昵称不能为空"}]},Ct=d=>{const l=Ge(d);return{password:l.password,newPassword:l.password}};function xt(){const d=pe(),l=L(!0),{userInfo:u}=A(H()),{isDark:c,menuIdx:p,subMenuIdx:m,textColor:_,bgColor:g,iconColor:x}=A(O()),{toggleTheme:w}=O(),{clear:k}=H(),I=L("updateUserInfo"),P=L(!1),D=R(()=>({color:_.value,backgroundColor:g.value})),M={class:"scale-125",size:20},C=R(()=>({color:x.value,backgroundColor:"transparent"})),i=L({nickname:u.value.nickName,avatar:{uid:"0",url:u.value.avatar}}),o=()=>{if(!i.value.nickname.trim())return b.warning("昵称不能为空"),!1;const a=new FormData;a.append("nickname",i.value.nickname),a.append("avatar",i.value.avatar.file),ot(a).then(v=>{v.code===200?(b.success("修改成功"),u.value.nickName=v.data.nickname,u.value.avatar=v.data.avatar,l.value=!0):b.error(`修改失败，${v.message}`)}).catch(()=>{b.error("修改失败")})},n=L({password:"",newPassword:""}),e=async()=>{if(!n.value.password.trim()||!n.value.newPassword.trim()){b.warning("密码不能为空");return}const a=await rt(n.value);a.code===200?(b.success("修改成功，请重新登录"),k(),await d.push("/entry")):b.error(`修改失败，${a.message}`)},t=L(!1),s=async()=>{k(),await d.replace("/entry"),b.success("退出登录成功")};return()=>r(Q,null,[r("div",{class:"w-screen flex items-center px-4",style:D.value},[r("div",{class:"flex items-center cursor-pointer select-none",onClick:()=>{p.value=0,m.value=0,d.push("/")}},[r(st,null,null)]),r("div",{class:"flex-1 flex justify-end items-center"},[r(f("a-button"),{shape:"circle",size:"large",class:"mr-1",style:C.value},{icon:()=>r(Q,null,[c.value?r(f("icon-moon"),oe(M,{onClick:w}),null):r(f("icon-sun"),oe(M,{onClick:w}),null)])}),r(wt,null,null),r(f("a-button"),{shape:"circle",size:"large",class:"mr-2"},{icon:()=>r(Q,null,[l.value?r("img",{src:u.value.avatar,alt:"",key:u.value.avatar,onError:()=>l.value=!1},null):r(f("icon-user"),M,null),q(" ")])}),r(f("a-dropdown"),{trigger:"hover"},{default:()=>r(f("a-button"),{type:"outline"},{default:()=>[r("span",{class:"max-w-32 truncate",style:{color:x.value}},[q("欢迎，"),u.value.nickName])]}),content:()=>r("div",{class:"w-28"},[r(f("a-doption"),{class:"w-28 flex justify-center",onClick:()=>{I.value="updateUserInfo",P.value=!0}},{default:()=>[q("修改信息")]}),r(f("a-doption"),{class:"w-28 flex justify-center",onClick:()=>{I.value="updatePassword",P.value=!0}},{default:()=>[q("修改密码")]}),r(f("a-doption"),{class:"w-28 flex justify-center"},{default:()=>[r("div",{onClick:()=>t.value=!0},[q("退出登录")])]})])})]),r(f("a-modal"),{visible:P.value,"onUpdate:visible":a=>P.value=a,closable:!1,"unmount-on-close":!0,title:I.value==="updateUserInfo"?"修改信息":"修改密码",okText:"提交",onOk:I.value==="updateUserInfo"?o:e,onCancel:()=>{n.value.password="",n.value.newPassword=""}},{default:()=>[I.value==="updateUserInfo"&&r(f("a-form"),{model:i.value,rules:bt},{default:()=>[r(f("a-form-item"),{field:"nickname",label:"用户名"},{default:()=>[r(f("a-input"),{modelValue:i.value.nickname,"onUpdate:modelValue":a=>i.value.nickname=a,placeholder:"用户名",allowClear:!0},null)]}),r(f("a-form-item"),{field:"avatar",label:"头像"},{default:()=>[r(f("a-upload"),{"show-file-list":!1,onChange:(a,v)=>{i.value.avatar=v},onProgress:a=>i.value.avatar=a},{"upload-button":()=>{var a;return r("div",{class:`arco-upload-list-item${((a=i.value.avatar)==null?void 0:a.status)==="error"?" arco-upload-list-item-error":""}`},[i.value.avatar.url?r("div",{class:"arco-upload-list-picture custom-upload-avatar"},[r("img",{src:i.value.avatar.url,alt:""},null),r("div",{class:"arco-upload-list-picture-mask"},[r(De,null,null)]),(i.value.avatar.status==="uploading"&&i.value.avatar.percent||!1)&&r(f("a-progress"),{percent:i.value.avatar.percent,type:"circle",size:"mini",style:{position:"absolute",left:"50%",top:"50%",transform:"translateX(-50%) translateY(-50%)"}},null)]):r("div",{class:"arco-upload-picture-card"},[r("div",{class:"arco-upload-picture-card-text"},[r(ze,null,null),r("div",{style:"margin-top: 10px; font-weight: 600"},[q("Upload")])])])])}})]})]}),I.value==="updatePassword"&&r(f("a-form"),{model:n.value,rules:R(()=>Ct(n.value.password)).value},{default:()=>[r(f("a-form-item"),{field:"password",label:"输入旧密码"},{default:()=>[r(f("a-input-password"),{modelValue:n.value.password,"onUpdate:modelValue":a=>n.value.password=a},null)]}),r(f("a-form-item"),{field:"newPassword",label:"确认新密码"},{default:()=>[r(f("a-input-password"),{modelValue:n.value.newPassword,"onUpdate:modelValue":a=>n.value.newPassword=a},null)]})]})]}),r(f("a-modal"),{visible:t.value,"onUpdate:visible":a=>t.value=a,closable:!1,"unmount-on-close":!0,onOk:async()=>{await s(),t.value=!1},onCancel:()=>t.value=!1,"ok-button-props":{status:"danger"}},{default:()=>[r("div",{class:"text-lg"},[q("确定要退出登录吗？")])]})]),r("div",{class:"w-full h-[1px] bg-[#E5E6EB]"},null)])}const It=W(xt,{props:[]}),Ft={class:"flex"},Ut={class:"w-20"},kt=["onClick"],Bt={class:"text-md"},At={key:0,class:"w-28"},St=["onClick"],Tt={class:"ml-3"},Pt={class:"flex flex-col justify-center items-center absolute bottom-10 left-1 text-xs"},ie=W({__name:"side-nav",setup(d){const{menuIdx:l,subMenuIdx:u,textColor:c,bgColor:p,isDark:m}=A(O()),{userInfo:_}=A(H()),g=R(()=>_.value.usedSpace/_.value.totalSpace),x=pe(),{isTree:w}=A(ae()),k=R(()=>({backgroundColor:p.value,color:c.value})),I=C=>C<.3?"#00B42A":C<.5?nt:C<.8?"#FF7D00":"#F53F3F",P=C=>C.path==="/admin"&&!_.value.isAdmin,D=async(C,i)=>{await x.push(C),u.value=0,l.value=i},M=async(C,i)=>{await x.push(C),u.value=i};return(C,i)=>{var n;const o=de;return U(),z("aside",{class:"h-full flex flex-col",style:G(h(k))},[S("div",Ft,[S("div",Ut,[(U(!0),z(Q,null,re(h(X),(e,t)=>(U(),z("div",{key:e.id,class:J(`${t===h(l)?"text-h-blue":""} h-20 flex flex-col justify-center
                    items-center select-none cursor-pointer hover:text-h-blue transition-all my-4`),onClick:s=>D(e.path,t)},[P(e)?V("",!0):(U(),z(Q,{key:0},[(U(),$(Y(e.icon),{class:"scale-[2] mb-4"})),S("div",Bt,j(e.name),1)],64))],10,kt))),128))]),!h(w)&&((n=h(X)[h(l)].children)!=null&&n.length)?(U(),z("div",At,[(U(!0),z(Q,null,re(h(X)[h(l)].children,(e,t)=>(U(),z("div",{key:t,class:J(`h-14 flex justify-center items-center rounded hover:text-h-blue cursor-pointer select-none ${t===h(u)?h(m)?"text-h-blue bg-[#333]":"text-h-blue bg-[#eee]":""}`),onClick:s=>M(e.path,t)},[(U(),$(Y(e.icon),{class:"scale-[1.3]"})),S("div",Tt,j(e.name),1)],10,St))),128))])):V("",!0)]),S("div",Pt,[r(o,{type:"circle",percent:+h(g).toFixed(2),color:I(h(g)),"stroke-width":4},null,8,["percent","color"]),i[0]||(i[0]=S("span",{class:"my-2"},"已用空间",-1)),q(" "+j(h(ee)(h(_).usedSpace))+"/"+j(h(ee)(h(_).totalSpace)),1)])],4)}}}),Et={class:"flex w-full h-full"},$t={class:"flex-1 overflow-auto"},qt=W({__name:"content",setup(d){const l=L(!1),{isDark:u,textColor:c,bgColor:p}=A(O());return(m,_)=>{const g=f("icon-double-right"),x=Le,w=f("router-view");return U(),z("main",Et,[r(et,null,{default:y(()=>[r(ie,{class:"hidden lg:flex"})]),_:1}),S("div",{class:"lg:hidden pl-2 top-12",style:G({backgroundColor:h(p),color:h(c)})},[r(g,{class:"scale-150 mt-10 hover:text-h-blue",onClick:_[0]||(_[0]=k=>l.value=!0)})],4),r(x,{width:220,placement:"left",closable:!1,footer:!1,visible:h(l),"onUpdate:visible":_[1]||(_[1]=k=>tt(l)?l.value=k:null),unmountOnClose:"",drawerStyle:{backgroundColor:h(p),color:h(c),borderRight:h(u)?"1px solid #BFBFBF":""}},{default:y(()=>[r(ie)]),_:1},8,["visible","drawerStyle"]),S("section",$t,[r(w)])])}}}),Mt=je(qt,[["__scopeId","data-v-27c07171"]]),aa=W({__name:"index",setup(d){const{bgColor:l}=A(O()),{updateUserInfo:u}=H();return at(u),(c,p)=>{const m=He,_=Ne,g=Re;return U(),$(g,{style:G([{height:"100vh",position:"relative"},{backgroundColor:h(l)}])},{default:y(()=>[r(m,null,{default:y(()=>[r(h(It))]),_:1}),r(_,{class:"overflow-auto"},{default:y(()=>[r(Mt)]),_:1})]),_:1},8,["style"])}}});export{aa as default};
