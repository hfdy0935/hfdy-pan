/* empty css              *//* empty css              *//* empty css              */import{u as ae,x as pe,y as me,z as fe,A as ve,C as le,s as ee,t as ye}from"./useFolderLevelTree-BY3VF7JM.js";import{u as Q,b as q,e as ke}from"./menuData-BfYzelEX.js";import{s as x,a as ge}from"./index-CdIjDISF.js";import{u as oe,a as be}from"./index.vue_vue_type_script_setup_true_lang-MDeg8KDO.js";import{d as Z,c as te,ag as X,aQ as se,am as P,o as c,a as Y,ap as s,ao as a,aG as o,an as v,aq as $,aX as k,aZ as G,al as we,e as z,aY as A,av as V,be as Ce,aE as _,bD as De,bH as Fe,bI as Se,bE as xe,bq as Ie,bm as Ne,aV as de,bK as Le,b as ne,aR as _e,bu as $e,ak as Te,bx as Ue,b0 as Be,b4 as Ee}from"./arco-design-vue-wpZPvk8Z.js";import{H as Re}from"./index-DeLZq7_u.js";import{u as he}from"./useEditFileName-BxV89-wi.js";/* empty css              */import"./index-DvwZTHc2.js";/* empty css              *//* empty css              */import{d as Me,a as W,c as Ve}from"./file-CTjv8ooS.js";import{u as qe}from"./share-BzanW0kV.js";import{i as Ke}from"./arco-design-vue-icon-S64ufJhU.js";import"./calc-CYjR0slx.js";import"./useBreadcrumb-DDMjDaLE.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */const Oe=Z({__name:"tree-contextmenu",props:{node:{}},setup(w){const{editingId:I,editNameOp:T,isContextmenuShow:U,layoutType:C}=x(Q()),{contextmenuItem:u,selectedFiles:N,selectedIds:g}=x(q()),{updateTreeData:K,doDelete:B}=q(),{openDetailModal:L}=ke(),{openShareFileModal:E}=qe(),R=ae(),f=te(()=>pe(R.isDark)),y=()=>{I.value=u.value.id,T.value="change"},h=async()=>{try{const t=await me(u.value.id);t.code===200?L(t.data):_.error(t.message)}catch{_.error("获取文件信息失败")}},D=X(!1),F=X(!1),M=t=>{D.value=!0,F.value=t},p=se("uploadLyric"),d=async(t,e)=>{var l;(l=e.name)!=null&&l.endsWith(".lrc")||_.warning("只支持lyc格式的歌词文件");try{const i=new FormData;i.append("lyric",e.file),i.append("fileId",u.value.id);const m=await fe(i);m.code===200?(_.success("上传成功"),K()):_.error(m.message)}catch{_.error("上传失败")}},r=te(()=>{var t;return g.value.length>1&&g.value.includes(((t=u.value)==null?void 0:t.id)??"")}),O=()=>{const t=r.value?N.value:[u.value];E(t)},S=async()=>{try{_.info("下载请求已提交");const t=r.value?N.value.map(m=>m.id):[u.value.id],e=u.value.name,l=await ve(t),i=document.createElement("a");i.href=URL.createObjectURL(l),i.download=r.value?"download.zip":e,i.click(),i.remove()}catch{_.error("下载失败")}};return(t,e)=>{const l=De,i=Fe,m=P("icon-share-internal"),n=Se,H=P("icon-music"),j=P("icon-edit"),re=P("icon-delete"),ie=xe,ue=Ie,ce=Ne;return c(),Y(Ce,null,[s(ie,{trigger:"contextMenu",alignPoint:"",onPopupVisibleChange:e[6]||(e[6]=b=>U.value=b)},{content:a(()=>[s(n,{title:"查看"},{default:a(()=>[o(r)?G("",!0):(c(),v(l,{key:0,onClick:h},{default:a(()=>[(c(),v($(o(f).detail))),e[9]||(e[9]=k("   详情 "))]),_:1})),s(i,{trigger:"hover"},{content:a(()=>[s(l,{onClick:e[0]||(e[0]=b=>C.value="list")},{default:a(()=>[(c(),v($(o(f).listLayout))),e[10]||(e[10]=k("  列表  "))]),_:1}),s(l,{onClick:e[1]||(e[1]=b=>C.value="block")},{default:a(()=>[(c(),v($(o(f).blockLayout))),e[11]||(e[11]=k("  方块  "))]),_:1}),s(l,{onClick:e[2]||(e[2]=b=>C.value="tree")},{default:a(()=>[(c(),v($(o(f).treeLayout))),e[12]||(e[12]=k("  树形  "))]),_:1})]),default:a(()=>[(c(),v($(o(f).contextmenuLayout))),e[13]||(e[13]=k("   布局 "))]),_:1}),s(l,{onClick:S},{default:a(()=>[s(o(Ke)),e[14]||(e[14]=k("   下载 "))]),_:1}),s(l,{onClick:O},{default:a(()=>[s(m),e[15]||(e[15]=k("   分享 "))]),_:1})]),_:1}),s(n,{title:"编辑"},{default:a(()=>[o(Me)(o(u))?(c(),v(l,{key:0,onClick:e[3]||(e[3]=b=>{var J;return(J=o(p))==null?void 0:J.$el.click()})},{default:a(()=>[s(H),e[16]||(e[16]=k("   上传歌词 "))]),_:1})):G("",!0),o(r)?G("",!0):(c(),v(l,{key:1,onClick:y},{default:a(()=>[s(j),e[17]||(e[17]=k("   重命名 "))]),_:1})),s(l,{onClick:e[4]||(e[4]=b=>M(!1))},{default:a(()=>[s(re),e[18]||(e[18]=k("   删除 "))]),_:1}),s(l,{onClick:e[5]||(e[5]=b=>M(!0))},{default:a(()=>[(c(),v($(o(f).deleteCompletely))),e[19]||(e[19]=k("   彻底删除   "))]),_:1})]),_:1})]),default:a(()=>[we(t.$slots,"default")]),_:3}),s(ue,{visible:o(D),"onUpdate:visible":e[7]||(e[7]=b=>V(D)?D.value=b:null),title:"提示",width:300,onOk:e[8]||(e[8]=b=>o(B)(o(F),o(r)?o(g):[t.node.id])),"unmount-on-close":"","ok-button-props":{status:"danger"},closable:!1},{default:a(()=>[z("h2",null,A(o(F)?"删除之后无法复原":"删除之后可在回收站找回"),1)]),_:1},8,["visible"]),s(ce,{ref:"uploadLyric",accept:".lrc",style:{display:"none"},"auto-upload":!1,onChange:d,"show-file-list":!1},null,512)],64)}}}),He=Z({__name:"tree-node-item",props:{node:{}},setup(w){var p;const{baseQuery:I,editingId:T,isContextmenuShow:U,editNameOp:C}=x(Q()),{treeData:u,contextmenuItem:N,selectedIds:g}=x(q()),{updateTreeData:K}=q(),B=((p=le(u.value,null,w.node.id))==null?void 0:p.id)??"",{name:L,handleFinishEidtInTree:E,resetName:R}=he({fileOrNode:w.node});function f(d){return I.value.keyword?d.toLowerCase().indexOf(I.value.keyword.toLowerCase()):-1}let y;const h=()=>{N.value=w.node},D=d=>{var r;return U.value&&g.value.includes(d.id)&&g.value.includes(((r=N.value)==null?void 0:r.id)??"")},F=se("rename_input");de(()=>{var d,r;(d=F.value)==null||d.focus(),(r=F.value)==null||r.$el.querySelector("input").select()});const M=()=>{const d=C.value==="create"?B:w.node.id,r=C.value==="create"?{ok:K,fail:()=>ee(u.value,[w.node.id]),err:()=>ee(u.value,[w.node.id])}:{ok:()=>w.node.name=L.value,fail:R,err:R};E(d,r)};return(d,r)=>{const O=_e;return o(T)===d.node.id?(c(),v(O,{key:0,"allow-clear":"",ref:"rename_input","model-value":o(L),"onUpdate:modelValue":r[0]||(r[0]=S=>V(L)?L.value=S:null),onKeyup:r[1]||(r[1]=Le(S=>o(F).blur(),["enter"])),onBlur:M},null,8,["model-value"])):(c(),v(Oe,{key:1,node:d.node},{default:a(()=>{var S,t;return[z("div",{style:ne({backgroundColor:D(d.node)?"#F2F3F5":""}),class:"w-44 rounded truncate"},[(V(y)?y.value=f(d.node.name):y=f(d.node.name),o(y)<0?(c(),Y("span",{key:0,onContextmenu:h},A(d.node.name),33)):(c(),Y("span",{key:1,onContextmenu:h},[z("span",null,A(d.node.name.slice(0,o(y))),1),z("span",{style:ne({color:o(Re)})},A(d.node.name.slice(o(y),o(y)+((S=o(I).keyword)==null?void 0:S.length))),5),z("span",null,A(d.node.name.slice(o(y)+((t=o(I).keyword)==null?void 0:t.length))),1)],32)))],4)]}),_:1},8,["node"]))}}}),yo=Z({__name:"tree-layout",setup(w){const{userInfo:I}=x(ge()),{breadcrumbs:T,editingId:U}=x(Q()),{replaceExcludeFirst:C}=Q(),{treeSelectedIds:u,treeData:N,selectedIds:g,filteredTreeData:K,treeSelectedPaths:B}=x(q()),{updateTreeData:L,doDropCut:E,prepareCreateFolder:R}=q(),{file:f,data:y,currentItem:h}=x(oe()),{getData:D,refreshControl:F}=oe(),{Icons:M}=x(ae()),p=X([]);de(()=>{L()}),$e(()=>{const t=T.value.length;u.value=t===1?[]:[T.value[t-1].id]}),Te(()=>f.value=null);const d=t=>{p.value.includes(t)?p.value=p.value.filter(e=>e!==t):p.value.push(t)},r=async(t,{node:e})=>{const l=e,i=t[0];W(l)?(d(l.id),C(...B.value),f.value=null):(u.value=[i],f.value={...l,updateTime:"",pid:""},C(...B.value.slice(0,-1)),F(),await D())},O=({dragNode:t,dropNode:e,dropPosition:l})=>{const i=t,m=e;if(W(m)&&l===0)E(m.children,m.id,i),p.value.includes(m.id)||p.value.push(m.id);else{const n=le(N.value,null,m.id),H=(n==null?void 0:n.children)??N.value;if(H.some(j=>j.id===i.id))return;E(H,(n==null?void 0:n.id)??"",i)}},S=t=>{p.value.push(t.id),R(t)};return(t,e)=>{const l=Ue,i=Be,m=Ee;return c(),v(m,{class:"h-full"},{default:a(()=>[s(i,{flex:"300px",class:"h-full pr-1 overflow-auto"},{default:a(()=>[s(l,{data:o(K),fieldNames:o(ye),"selected-keys":o(u),"onUpdate:selectedKeys":e[0]||(e[0]=n=>V(u)?u.value=n:null),"expanded-keys":o(p),"onUpdate:expandedKeys":e[1]||(e[1]=n=>V(p)?p.value=n:null),"checked-keys":o(g),"onUpdate:checkedKeys":e[2]||(e[2]=n=>V(g)?g.value=n:null),"check-strictly":"",onSelect:r,draggable:!o(U),blockNode:"",checkable:"",onDrop:O},{title:a(n=>[s(He,{node:n},null,8,["node"])]),"drag-icon":a(()=>e[3]||(e[3]=[])),extra:a(n=>[o(W)(n)&&o(U)!==n.id&&o(Ve)(n)<o(I).maxFolderLevel?(c(),v($(o(M).newFolder),{key:0,onClick:H=>S(n),class:"hover:text-h-blue"},null,8,["onClick"])):G("",!0)]),_:1},8,["data","fieldNames","selected-keys","expanded-keys","checked-keys","draggable"])]),_:1}),s(i,{flex:"auto",class:"h-full relative overflow-hidden"},{default:a(()=>{var n;return[s(be,{data:o(y),file:o(f),getData:o(D),comp:(n=o(h))==null?void 0:n.component},null,8,["data","file","getData","comp"])]}),_:1})]),_:1})}}});export{yo as default};
