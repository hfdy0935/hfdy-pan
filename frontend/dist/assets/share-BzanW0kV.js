import{g as s,i as F,j as D}from"./index-CdIjDISF.js";import{u as q}from"./useBreadcrumb-DDMjDaLE.js";import{l as M}from"./useFolderLevelTree-BY3VF7JM.js";import{ag as a,c as p,aE as f}from"./arco-design-vue-wpZPvk8Z.js";function x(e){const{id:t,...r}=e;return s({url:`/share/${t}`,method:"GET",params:r})}function L(e){return s({url:"/share/download",method:"POST",data:{fileIds:e},responseType:"blob"})}function j(e){return s({url:"/shareFile",method:"POST",data:e})}function O(){return s({url:"/shareFile",method:"GET"})}function A(e){return s({url:"/shareFile",method:"DELETE",params:{id:e}})}function H(e){return s({url:"/shareFile/options",method:"PUT",data:e})}function R(e,t){return s({url:"/shareFile/files",method:"PUT",data:{fileIds:e,shareId:t}})}const g={minute:{title:"分钟",rate:60},hour:{title:"小时",rate:60*60},day:{title:"天",rate:24*60*60},week:{title:"周",rate:7*24*60*60},month:{title:"月",rate:30*24*60*60},year:{title:"年",rate:365*24*60*60}},$=Object.entries(g).map(([e,t])=>({value:e,label:t.title}));function I(){const e=a({expire:"day",value:7,noDdl:!1,pwd:""}),t=p(()=>({expire:e.value.noDdl?-1:g[e.value.expire].rate*e.value.value,pwd:e.value.pwd}));return{config:e,formattedConfig:t}}const z=F("setShareFileStore",()=>{const e=a([]),t=a(!1);return{sharedFiles:e,show:t,openShareFileModal:n=>{e.value=[...n],t.value=!0}}}),J=F("updateShareStore",()=>{const e=a(""),t=a([]),r=async()=>{try{const u=await O();u.code===200?t.value=u.data:f.error(u.message)}catch{f.error("获取文件列表失败")}},{config:n,formattedConfig:m}=I(),{treeDataAllowFile:d,selectedIds:c,selectedPaths:l,updateTreeLayerData:S}=M();return{shareId:e,shareData:t,updateData:r,config:n,formattedConfig:m,treeDataAllowFile:d,selectedIds:c,selectedPaths:l,updateTreeLayerData:S}}),K=F("getShareStore",()=>{const e=D(),t=a({}),r=a(!1),{breadcrumbs:n,switchTo:m}=q(),d=p(()=>e.params.shareId),c=a(""),l=a([]),S=p(()=>{var h;return((h=t.value)==null?void 0:h.records.filter(i=>l.value.includes(i.id)))??[]}),u=p(()=>l.value.includes(y.value.id)),y=a({}),w=a(!1),T=a("top");return{sharedFiles:t,updateFolder:async({pid:h,pwdErrorCB:i,okCb:v}={})=>{try{r.value=!0;const o=await x({id:d.value,pwd:c.value||e.params.pwd,pid:h});o.code===200?(t.value=o.data,m(o.data.parent),v==null||v(o.data)):o.code===632?i==null||i():f.error(o.message)}catch{f.error("获取失败")}finally{r.value=!1}},breadcrumbs:n,spinning:r,shareId:d,pwd:c,selectedIds:l,selectedFiles:S,shouldHandleGroup:u,contextItem:y,treeModalShow:w,modalPos:T}});export{I as a,J as b,A as c,H as d,g as e,R as f,K as g,L as h,j as r,$ as s,z as u};
