/* empty css              *//* empty css              */import{u as te,a as z,e as Re}from"./menuData-BfYzelEX.js";import{u as se}from"./index.vue_vue_type_script_setup_true_lang-MDeg8KDO.js";import"./index-DvwZTHc2.js";/* empty css              *//* empty css              */import{u as oe,x as _e,y as Ne,z as Te,A as Me,T as U,d as qe,B as Be,w as Ue}from"./useFolderLevelTree-BY3VF7JM.js";import{s as b,a as ie}from"./index-CdIjDISF.js";import{d as Ve,c as re,e as Oe,a as Pe}from"./file-CTjv8ooS.js";import{u as ze}from"./share-BzanW0kV.js";import{i as He}from"./arco-design-vue-icon-S64ufJhU.js";import{d as ne,c as $,ag as ee,aQ as ue,am as D,o as l,a as K,ap as n,ao as o,aG as t,an as s,aq as c,aX as r,aZ as S,al as Ae,e as de,aY as me,av as ce,be as pe,aE as C,bD as fe,bH as ve,bI as Ge,bE as ye,bq as Ke,bm as We,E as je,C as Je,D as Qe,H as Xe,aV as Ye,bJ as Ze,b as G,b5 as he,bK as et,bc as tt,bL as ot,aR as nt,bz as lt}from"./arco-design-vue-wpZPvk8Z.js";import{u as at}from"./useEditFileName-BxV89-wi.js";import{H as st}from"./index-DeLZq7_u.js";const St=ne({__name:"normal",setup(d){const{isDark:x}=b(oe()),{isContextmenuShow:F,editNameOp:E,layoutType:I,editingId:y,isMaxFolderLevel:V,currParentFolder:i}=b(te()),{contextmenuItem:f,contextmenuType:O,query:g,selectedFiles:L,shouldHandleGroup:m}=b(z()),{updateFileItem:R,doDelete:_,doPaste:W,prepareCreateFolder:N,prepareCut:j,prepareCopy:P,clearSelected:J}=z(),{openPreviewModal:Q}=se(),{userInfo:X}=b(ie()),{openDetailModal:H}=Re(),{openShareFileModal:Y}=ze(),a=$(()=>_e(x.value)),k=()=>{y.value=f.value.id,E.value="change"},T=async()=>{var p;if(O.value==="folder"){if(re(i.value)===X.value.maxFolderLevel){C.warning("已达到最大深度，不支持打开");return}g.value={...g.value,page:1,pid:(p=f.value)==null?void 0:p.id},J()}else Q(f.value)},Z=async()=>{try{const p=await Ne(f.value.id);p.code===200?H(p.data):C.error(p.message)}catch{C.error("获取文件信息失败")}},A=$(()=>m.value?L.value:[f.value]),M=ee(!1),q=ee(!1),le=p=>{q.value=p,M.value=!0},ke=$(()=>!m.value&&Ve(f.value)),Ce=ue("uploadLyric"),ge=async(p,e)=>{var u;(u=e.name)!=null&&u.endsWith(".lrc")||C.warning("只支持lyc格式的歌词文件");try{const w=new FormData;w.append("lyric",e.file),w.append("fileId",f.value.id);const B=await Te(w);B.code===200?(C.success("上传成功"),R()):C.error(B.message)}catch{C.error("上传失败")}},we=()=>{const p=m.value?L.value:[f.value];Y(p)},be=async()=>{try{C.info("下载请求已提交");const p=m.value?L.value.map(B=>B.id):[f.value.id],e=f.value.name,u=await Me(p),w=document.createElement("a");w.href=URL.createObjectURL(u),w.download=m.value?"download.zip":e,w.click(),w.remove()}catch{C.error("下载失败")}};return(p,e)=>{const u=fe,w=ve,B=D("icon-share-internal"),h=Ge,Fe=D("icon-copy"),Se=D("icon-paste"),Ie=D("icon-music"),Le=D("icon-edit"),De=D("icon-delete"),$e=ye,xe=Ke,Ee=We;return l(),K(pe,null,[n($e,{trigger:"contextMenu",alignPoint:"",onPopupVisibleChange:e[8]||(e[8]=v=>F.value=v)},{content:o(()=>[n(h,{title:"查看"},{default:o(()=>[t(m)?S("",!0):(l(),s(u,{key:0,onClick:T},{default:o(()=>[(l(),s(c(t(a).open))),e[11]||(e[11]=r("  打开 "))]),_:1})),t(m)?S("",!0):(l(),s(u,{key:1,onClick:Z},{default:o(()=>[(l(),s(c(t(a).detail))),e[12]||(e[12]=r("  详情 "))]),_:1})),n(w,{trigger:"hover"},{content:o(()=>[n(u,{onClick:e[0]||(e[0]=v=>I.value="list")},{default:o(()=>[(l(),s(c(t(a).listLayout),{style:{transform:"scale(1.4)"}})),e[13]||(e[13]=r("   列表  "))]),_:1}),n(u,{onClick:e[1]||(e[1]=v=>I.value="block")},{default:o(()=>[(l(),s(c(t(a).blockLayout))),e[14]||(e[14]=r("   方块  "))]),_:1}),n(u,{onClick:e[2]||(e[2]=v=>I.value="tree")},{default:o(()=>[(l(),s(c(t(a).treeLayout))),e[15]||(e[15]=r("   树  "))]),_:1})]),default:o(()=>[(l(),s(c(t(a).contextmenuLayout))),e[16]||(e[16]=r("  布局 "))]),_:1}),n(u,{onClick:be},{default:o(()=>[n(t(He)),e[17]||(e[17]=r("  下载 "))]),_:1}),n(u,{onClick:we},{default:o(()=>[n(B),e[18]||(e[18]=r("  分享 "))]),_:1})]),_:1}),n(h,{title:"移动"},{default:o(()=>[n(u,{onClick:e[3]||(e[3]=v=>t(P)(t(A)))},{default:o(()=>[n(Fe),e[19]||(e[19]=r("  复制 "))]),_:1}),n(u,{onClick:e[4]||(e[4]=v=>t(j)(t(A)))},{default:o(()=>[(l(),s(c(t(a).cut))),e[20]||(e[20]=r("  剪切 "))]),_:1}),n(u,{onClick:t(W)},{default:o(()=>[n(Se),e[21]||(e[21]=r("  粘贴 "))]),_:1},8,["onClick"])]),_:1}),n(h,{title:"编辑"},{default:o(()=>[t(V)?S("",!0):(l(),s(u,{key:0,onClick:t(N)},{default:o(()=>[(l(),s(c(t(a).newFolder))),e[22]||(e[22]=r("  新建文件夹  "))]),_:1},8,["onClick"])),t(ke)?(l(),s(u,{key:1,onClick:e[5]||(e[5]=v=>{var ae;return(ae=t(Ce))==null?void 0:ae.$el.click()})},{default:o(()=>[n(Ie),e[23]||(e[23]=r("  上传歌词 "))]),_:1})):S("",!0),t(m)?S("",!0):(l(),s(u,{key:2,onClick:k},{default:o(()=>[n(Le),e[24]||(e[24]=r("  重命名 "))]),_:1})),n(u,{onClick:e[6]||(e[6]=v=>le(!1))},{default:o(()=>[n(De),e[25]||(e[25]=r("  删除 "))]),_:1}),n(u,{onClick:e[7]||(e[7]=v=>le(!0))},{default:o(()=>[(l(),s(c(t(a).deleteCompletely))),e[26]||(e[26]=r("  彻底删除 "))]),_:1})]),_:1})]),default:o(()=>[Ae(p.$slots,"default")]),_:3}),n(xe,{visible:t(M),"onUpdate:visible":e[9]||(e[9]=v=>ce(M)?M.value=v:null),title:"提示",onOk:e[10]||(e[10]=v=>t(_)(t(q))),"unmount-on-close":"","ok-button-props":{status:"danger"},closable:!1,width:300},{default:o(()=>[de("h2",null,me(t(q)?"删除之后无法复原":"删除之后可在回收站找回"),1)]),_:1},8,["visible"]),n(Ee,{ref:"uploadLyric",accept:".lrc",style:{display:"none"},"auto-upload":!1,onChange:ge,"show-file-list":!1},null,512)],64)}}}),it={key:0,class:"w-8 h-6"},It=ne({__name:"file-icon-name",props:{item:{},iconStyle:{},nameStyle:{},inputWidth:{}},setup(d){const x=oe(),{editingId:F,editNameOp:E,currParentFolder:I}=b(te()),{itemList:y,contextmenuItem:V,query:i}=b(z()),{clearSelected:f,updateFileItem:O}=z(),{openPreviewModal:g}=se(),{userInfo:L}=b(ie()),{name:m,handleFinishEidtInListBlock:R,resetName:_}=at({fileOrNode:y.value.records.filter(a=>a.id===d.item.id)[0]}),W=$(()=>d.item.mediaType==="video"),N=$(()=>{switch(d.item.status){case U.NO_NEED:return{desc:"无需转码",comp:Xe};case U.ING:return{desc:"转码中",comp:Qe,color:st,spin:!0};case U.OK:return{desc:"转码成功",comp:Je,color:"green"};case U.ERR:return{desc:"转码失败，点击重试",comp:je,color:"red"}}}),j=$(()=>d.item.mediaType==="folder"?x.FileIcons.folder:qe(d.item.name)),P=ue("rename_input");$(()=>{var a;return F.value&&((a=V.value)==null?void 0:a.id)===d.item.id}),Ye(()=>{var a,k;(a=P.value)==null||a.focus(),(k=P.value)==null||k.$el.querySelector("input").select()});const J=()=>{d.item.status===U.ERR&&(C.success("转码请求已提交，请耐心等待"),Be(d.item.id),d.item.status=U.ING)},Q=async()=>{if(Pe(d.item)){if(re(I.value)===L.value.maxFolderLevel){C.warning("已达到最大深度，不支持打开");return}i.value={...i.value,page:1,pid:d.item.id},f()}else g(d.item)},X=()=>{const a=E.value==="create"?y.value.parent.id:V.value.id,k=E.value==="create"?{ok:O,fail:_,err:_}:{ok(){for(const T of y.value.records)T.id===d.item.id&&(T.name=m.value)},fail:_,err:_};R(a,k)},H=ee(""),Y=async()=>{const a=await Ue(d.item.id,new AbortController);return H.value=URL.createObjectURL(a),H.value};return(a,k)=>{const T=tt,Z=ot,A=nt,M=Ze("lazy");return l(),K(pe,null,[n(Z,{style:G(a.iconStyle)},{content:o(()=>[t(W)?(l(),s(T,{key:0,content:t(N).desc},{default:o(()=>[(l(),s(c(t(N).comp),{onClick:J,size:10,spin:t(N).spin,class:"cursor-pointer",style:G({color:t(N).color})},null,8,["spin","style"]))]),_:1},8,["content"])):S("",!0)]),default:o(()=>[t(Oe)(a.item)?he((l(),K("img",it,null,512)),[[M,Y]]):(l(),s(c(t(j)),{key:1,class:"w-6"}))]),_:1},8,["style"]),t(F)===a.item.id?(l(),s(A,{key:0,"model-value":t(m),"onUpdate:modelValue":k[0]||(k[0]=q=>ce(m)?m.value=q:null),style:G({...a.nameStyle,width:`${a.inputWidth??120}px`}),ref:"rename_input",onBlur:X,onKeyup:k[1]||(k[1]=et(q=>t(P).blur(),["enter"]))},null,8,["model-value","style"])):(l(),K("div",{key:1,class:"w-full truncate",style:G(a.nameStyle)},[de("span",{class:"group-hover:text-h-blue cursor-pointer hover:text-h-blue select-none",onDblclick:Q},me(t(m)),33)],4))],64)}}}),Lt=ne({__name:"blank",setup(d){const{isMaxFolderLevel:x,layoutType:F}=b(te()),{doPaste:E,prepareCreateFolder:I}=z(),{Icons:y}=b(oe());return(V,i)=>{const f=lt,O=D("icon-drag-arrow"),g=fe,L=ve,m=ye;return l(),s(m,{trigger:"contextMenu",alignPoint:""},{content:o(()=>[t(x)?S("",!0):(l(),s(g,{key:0,onClick:t(E)},{default:o(()=>[n(O),i[3]||(i[3]=r("  粘贴 "))]),_:1},8,["onClick"])),t(x)?S("",!0):(l(),s(g,{key:1,onClick:t(I)},{default:o(()=>[(l(),s(c(t(y).newFolder))),i[4]||(i[4]=r("  新建文件夹  "))]),_:1},8,["onClick"])),n(L,{trigger:"hover"},{content:o(()=>[n(g,{onClick:i[0]||(i[0]=R=>F.value="list")},{default:o(()=>[(l(),s(c(t(y).listLayout),{style:{transform:"scale(1.4)"}})),i[5]||(i[5]=r("  列表  "))]),_:1}),n(g,{onClick:i[1]||(i[1]=R=>F.value="block")},{default:o(()=>[(l(),s(c(t(y).blockLayout))),i[6]||(i[6]=r("  方块  "))]),_:1}),n(g,{onClick:i[2]||(i[2]=R=>F.value="tree")},{default:o(()=>[(l(),s(c(t(y).treeLayout))),i[7]||(i[7]=r("  树形  "))]),_:1})]),default:o(()=>[(l(),s(c(t(y).contextmenuLayout))),i[8]||(i[8]=r("  布局 "))]),_:1})]),default:o(()=>[n(f)]),_:1})}}});export{It as _,St as a,Lt as b};
