/* empty css              *//* empty css              *//* empty css              */import{d as L,i as N}from"./file-Bu8a5mjb.js";import{g as b,h as G}from"./share-Bj4d4icF.js";/* empty css              */import{s as M,M as h,a6 as H,u as J,N as P,c as W,B as R,a9 as Y,v as Q,ao as X,p as Z,t as ee,a1 as te,a4 as oe,ap as se,J as ae,K as ne,ab as le,a8 as re,a5 as de}from"./index-fDEUsWmJ.js";import{d as V,aa as z,o as ie,w as ce,b as m,i as F,j as n,k as t,$ as d,Y as B,e as x,B as S,y as j,r as E,c as $,F as K,h as U,C,l as q,z as ue,g as me,q as O,P as pe}from"./vue-office_docx-BTzFQIdC.js";/* empty css              */import{w as _e,t as fe,F as ve,x as ye,u as A,d as we,m as he}from"./useFolderLevelTree-CDJ_26ol.js";import{a as xe}from"./index-DMMyicpo.js";import{c as ke}from"./calc-CYjR0slx.js";import{_ as be}from"./logo.vue_vue_type_script_setup_true_lang-DPWU2qmp.js";import"./useBreadcrumb-DKPyaTjD.js";import"./vue-office_excel-HlhG_4Om.js";import"./vue-office_pdf-1kjn8M9t.js";import"./vue-office_pptx-Ci_UBxwQ.js";import"./index-DeLZq7_u.js";const ge={class:"float-right mt-3"},Ie=V({__name:"file-extract-modal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(_){const l=z(_,"modelValue"),{pwd:o}=M(b()),{updateFolder:f}=b(),i=()=>f({pwdErrorCB(){o.value?h.error("提取码错误"):h.warning("请输入提取码")},okCb(){h.success("提取成功"),l.value=!1}}),y=H(),a=J();return ie(()=>{o.value=y.query.pwd,i()}),ce(o,u=>{a.replace({query:{pwd:u}})}),(u,e)=>{const s=W,v=R,p=P;return m(),F(p,{visible:l.value,"onUpdate:visible":e[1]||(e[1]=r=>l.value=r),title:"请输入提取码",footer:!1,width:480},{default:n(()=>[t(s,{modelValue:d(o),"onUpdate:modelValue":e[0]||(e[0]=r=>B(o)?o.value=r:null),allowClear:""},null,8,["modelValue"]),x("div",ge,[t(v,{type:"primary",onClick:i},{default:n(()=>e[2]||(e[2]=[S("提取")])),_:1})])]),_:1},8,["visible"])}}}),$e={class:"flex justify-end mt-6"},Fe=V({__name:"tree-modal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(_){const l=z(_,"modelValue"),{shareId:o,selectedFiles:f,selectedIds:i,contextItem:y,shouldHandleGroup:a,modalPos:u}=M(b()),{selectedIds:e,treeDataBanFileWithRoot:s,updateTreeLayerData:v}=_e();j(v);let p=!1;const r=(c,{node:w})=>{var D;const g=f.value.map(I=>I.name),T=(D=w.children)==null?void 0:D.map(I=>I.name);new Set([...g,...T]).size<g.length+T.length?(h.warning("同一目录下的文件/文件夹名不能重复"),p=!1):p=!0},k=async()=>{if(e.value.length===0){h.warning("请先选择要保存到哪个文件夹");return}if(!p){h.warning("同一目录下的文件/文件夹名不能重复");return}const c=u.value==="bottom"?a.value?i.value:[y.value.id]:i.value;try{if(!c.length){h.warning("请选择要保存的文件/文件夹");return}const w=e.value[0]===ve?"":e.value[0],g=await ye({shareId:o.value,srcIds:c,to:w});g.code===200?h.success("转存成功"):h.error(g.message)}catch{h.error("转存失败")}finally{l.value=!1}};return(c,w)=>{const g=Y,T=R,D=P;return m(),F(D,{visible:l.value,"onUpdate:visible":w[2]||(w[2]=I=>l.value=I),title:"选择转存路径",footer:!1},{default:n(()=>[t(g,{data:d(s),fieldNames:d(fe),"selected-keys":d(e),"onUpdate:selectedKeys":w[0]||(w[0]=I=>B(e)?e.value=I:null),"checked-keys":d(e),"onUpdate:checkedKeys":w[1]||(w[1]=I=>B(e)?e.value=I:null),onSelect:r,"check-strictly":"",multiple:!1},null,8,["data","fieldNames","selected-keys","checked-keys"]),x("div",$e,[t(T,{type:"primary",onClick:k},{default:n(()=>w[3]||(w[3]=[S("保存")])),_:1})])]),_:1},8,["visible"])}}}),Ce={class:"flex justify-around items-center px-2"},Ve={class:"text-lg"},Se={class:"my-2"},Me={class:"my-2"},Be={class:"flex flex-col"},Te=V({__name:"index",setup(_){const{sharedFiles:l,treeModalShow:o,modalPos:f}=M(b()),i=E(!1);return(y,a)=>{const u=X,e=Z,s=ee,v=Q,p=U("icon-save"),r=R,k=U("icon-link");return m(),$(K,null,[x("div",Ce,[t(v,{bordered:!1},{default:n(()=>[t(s,{class:"list-demo-item","action-layout":"vertical"},{default:n(()=>[t(e,null,{title:n(()=>[x("span",Ve," 分享者："+C(d(l).username),1)]),description:n(()=>[x("div",Se,"创建时间： "+C(d(l).createTime),1),x("div",Me,"围观次数： "+C(d(l).visitNum),1)]),avatar:n(()=>[t(u,{"image-url":d(l).avatar,class:"scale-[2.2] mr-6"},null,8,["image-url"])]),_:1})]),_:1})]),_:1}),x("div",Be,[t(r,{type:"primary",class:"my-3",onClick:a[0]||(a[0]=c=>{f.value="top",o.value=!0})},{icon:n(()=>[t(p)]),default:n(()=>[a[4]||(a[4]=S("转存 "))]),_:1}),t(r,{type:"primary",status:"success",onClick:a[1]||(a[1]=c=>i.value=!0)},{icon:n(()=>[t(k)]),default:n(()=>[a[5]||(a[5]=S("提取 "))]),_:1})])]),t(Fe,{modelValue:d(o),"onUpdate:modelValue":a[2]||(a[2]=c=>B(o)?o.value=c:null)},null,8,["modelValue"]),t(Ie,{modelValue:d(i),"onUpdate:modelValue":a[3]||(a[3]=c=>B(i)?i.value=c:null)},null,8,["modelValue"])],64)}}}),Ue=V({__name:"context-menu",setup(_){const{shouldHandleGroup:l,contextItem:o,selectedIds:f,treeModalShow:i,modalPos:y}=M(b()),{updateFolder:a}=b(),{openPreviewModal:u}=L(),e=A(),s=async()=>{N(o.value)?(f.value=[],await a({pid:o.value.id})):u(o.value)},v=async()=>{try{h.info("下载请求已提交");const p=l.value?f.value:[o.value.id],r=p.length>1?"download.zip":o.value.name,k=await G(p),c=document.createElement("a");c.href=URL.createObjectURL(k),c.download=r,c.click(),c.remove()}catch{h.error("下载失败")}};return(p,r)=>{const k=te,c=U("icon-save"),w=U("icon-download"),g=oe;return m(),F(g,{trigger:"contextMenu",alignPoint:""},{content:n(()=>[d(l)?ue("",!0):(m(),F(k,{key:0,onClick:s},{default:n(()=>[(m(),F(q(d(e).Icons.open))),r[1]||(r[1]=S(" 打开   "))]),_:1})),t(k,{onClick:r[0]||(r[0]=T=>{y.value="bottom",i.value=!0})},{default:n(()=>[t(c),r[2]||(r[2]=S(" 转存 "))]),_:1}),t(k,{onClick:v},{default:n(()=>[t(w),r[3]||(r[3]=S(" 下载 "))]),_:1})]),default:n(()=>[me(p.$slots,"default")]),_:3})}}}),De={class:"min-h-14 flex items-center"},Ne={key:0,class:"flex justify-start items-center"},Re={key:1,class:"min-w-36 ml-3"},Le={key:2,class:"w-full text-center"},Pe={key:3,class:"mx-4"},ze=V({__name:"table-cell",props:{column:{},record:{},rowIndex:{}},setup(_){const{selectedIds:l,shareId:o}=M(b()),{updateFolder:f}=b(),{openPreviewModal:i}=L(),y=A(),a=O(()=>N(_.record)?y.FileIcons.folder:we(_.record.name)),u=async()=>{N(_.record)?(l.value=[],await f({pid:_.record.id})):await i(_.record)},e=E("");return j(async()=>{if(_.record.category!=="image")return;const s=await he(_.record.id,new AbortController,o.value);e.value=URL.createObjectURL(s)}),(s,v)=>{const p=se;return m(),$("td",null,[t(Ue,null,{default:n(()=>[x("div",De,[s.column.dataIndex==="name"?(m(),$("div",Ne,[d(e)?(m(),F(p,{key:0,src:d(e),width:30,height:30},null,8,["src"])):(m(),F(q(d(a)),{key:1,class:"scale-150"})),x("span",{class:"cursor-pointer hover:text-h-blue select-none ml-3",onDblclick:u},C(s.record.name),33)])):s.column.dataIndex==="updateTime"?(m(),$("div",Re,C(s.record.updateTime),1)):s.column.dataIndex==="index"?(m(),$("div",Le,C(s.rowIndex+1),1)):(m(),$("span",Pe,C(s.column.dataIndex==="size"&&s.record.mediaType!=="folder"?d(ke)(s.record.size):s.record.size),1))])]),_:1})])}}}),je={class:"hover:text-h-blue cursor-pointer"},Ee=V({__name:"breadcrumb",setup(_){const{breadcrumbs:l,sharedFiles:o}=M(b()),{updateFolder:f}=b(),i=async y=>{o.value.parent.id!==y&&await f({pid:y})};return(y,a)=>{const u=U("icon-home"),e=ne,s=ae;return m(),F(s,{separator:">",class:"select-none flex flex-wrap"},{default:n(()=>[t(e,{onClick:a[0]||(a[0]=v=>i(d(l)[0].id))},{default:n(()=>[t(u,{size:18,class:"hover:text-h-blue cursor-pointer"})]),_:1}),(m(!0),$(K,null,pe(d(l).slice(1),v=>(m(),F(e,{key:v.id,onClick:p=>i(v.id)},{default:n(()=>[x("div",je,C(v.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})}}}),Ke={class:"h-full overflow-auto"},qe=V({__name:"index",setup(_){const{contextItem:l,sharedFiles:o,selectedIds:f}=M(b()),i=O(()=>{var u;return((u=o.value.records)==null?void 0:u.map(e=>({...e,key:e.id})))??[]}),y=u=>{const{key:e,...s}=u;l.value={...s}},a=[{title:"序号",dataIndex:"index",width:60},{title:"文件名",dataIndex:"name"},{title:"修改时间",dataIndex:"updateTime"},{title:"大小",dataIndex:"size"}];return(u,e)=>{const s=le,v=de,p=re;return m(),$("section",Ke,[t(s),t(Ee),t(p,{columns:a,class:"mt-3 mr-3",data:d(i),hoverable:"",pagination:!1,scroll:{x:700},onRowContextmenu:y,"row-selection":{type:"checkbox",showCheckedAll:!0},selectedKeys:d(f),"onUpdate:selectedKeys":e[0]||(e[0]=r=>B(f)?f.value=r:null)},{td:n(({column:r,record:k,rowIndex:c})=>[t(ze,{column:r,record:k,rowIndex:c},null,8,["column","record","rowIndex"])]),empty:n(()=>[t(v,{description:"还没有任何文件~"})]),_:1},8,["data","selectedKeys"]),t(xe)])}}}),Oe={class:"py-3"},Ae={class:"flex justify-center"},Ge={class:"pl-3"},ut=V({__name:"index",setup(_){return document.title="分享文件",(l,o)=>(m(),$("div",Oe,[x("div",Ae,[t(be,{"hide-title":!1})]),t(Te),x("div",Ge,[t(qe)])]))}});export{ut as default};
