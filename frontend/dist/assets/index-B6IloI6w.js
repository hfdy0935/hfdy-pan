/* empty css              */import{_ as kt,a as gt}from"./index-DMMyicpo.js";import{i as wt,j as ze,u as oe,d as Me,k as Ie,T as le,l as Ct,m as bt,n as Pe,o as Oe,p as qe,q as Ae,s as Be,t as xt,v as Ft}from"./useFolderLevelTree-CDJ_26ol.js";import{u as W,a as H,b as ne,c as It,d as pe,e as Se,i as ie,f as St,g as we,h as Ke,O as me,j as Ve}from"./file-Bu8a5mjb.js";/* empty css              */import{m as $t,c as Re}from"./menuData-B28-nopt.js";import{s as F,G as je,M as E,U as $e,B as ge,H as ht,m as Ge,J as Dt,K as Lt,N as fe,v as He,t as Tt,n as Ut,L as Et,C as We,R as Qe,O as Nt,F as zt,Q as Bt,V as Vt,d as Rt,e as Mt,q as Pt,a as Ce,W as Ot,X as qt,Y as At,Z as Kt,T as jt,$ as Gt,c as Ye,a0 as Je,a1 as he,a2 as De,a3 as Xe,a4 as Le,a5 as Ht,a6 as Wt,a7 as Qt,a8 as Yt,a9 as Jt,aa as Xt,ab as Zt}from"./index-fDEUsWmJ.js";import{d as Q,q as j,ab as ye,b as i,c as P,k as t,j as n,h as K,$ as e,B as k,e as O,Y as Z,F as re,P as Te,i as f,C as q,l as z,z as Y,r as ae,y as Ue,ad as en,f as se,N as tn,V as Ze,g as et,w as Fe,A as nn,o as on,ae as tt,a as ln}from"./vue-office_docx-BTzFQIdC.js";/* empty css              *//* empty css              */import{c as nt}from"./calc-CYjR0slx.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{u as Ee,a as an,s as sn,r as rn,e as un}from"./share-Bj4d4icF.js";import{H as ot}from"./index-DeLZq7_u.js";/* empty css              */import"./useBreadcrumb-DKPyaTjD.js";import"./vue-office_excel-HlhG_4Om.js";import"./vue-office_pdf-1kjn8M9t.js";import"./vue-office_pptx-Ci_UBxwQ.js";const dn={class:"flex justify-between items-start"},cn=Q({__name:"file-operation",setup(I){const{baseQuery:x,isTree:o,currParentFolder:b,isMaxFolderLevel:_}=F(W()),{itemList:c}=F(H()),{prepareCreateFolder:h}=H(),{prepareCreateFolder:d}=ne(),{uploadFileList:m}=F(It()),g=j(()=>c.value.records.map(w=>w.name)),y=ye("inputFile"),r=(w,s)=>{if(g.value.includes(s.name??"")){E.warning("同一个目录下的文件、文件夹名不能重复");return}m.value.push({md5:"",fileItem:s,totalChunks:1,uploadedChunkIndexs:[],index:m.value.length,status:"parse",pid:b.value.id,level:b.value.level})};return(w,s)=>{const l=K("icon-upload"),p=$e,$=ge,N=K("icon-folder"),B=je,C=ht;return i(),P("div",dn,[t(B,{wrap:"",size:"medium"},{default:n(()=>[t($,{onClick:s[0]||(s[0]=S=>{var L;return(L=e(y))==null?void 0:L.$el.click()}),type:"primary",disabled:e(_)},{icon:n(()=>[t(l,{"stroke-width":6,size:16})]),default:n(()=>[s[3]||(s[3]=k(" 上传 ")),t(p,{onChange:r,multiple:"",ref:"inputFile",style:{display:"none"},"auto-upload":!1,"show-file-list":!1},null,512)]),_:1},8,["disabled"]),t($,{type:"primary",onClick:s[1]||(s[1]=S=>e(o)?e(d)():e(h)()),status:"success",disabled:e(_)},{icon:n(()=>[t(N,{"stroke-width":6,size:16})]),default:n(()=>[s[4]||(s[4]=k("新建 "))]),_:1},8,["disabled"])]),_:1}),t(B,{size:"medium"},{default:n(()=>[t(C,{modelValue:e(x).keyword,"onUpdate:modelValue":s[2]||(s[2]=S=>e(x).keyword=S),modelModifiers:{trim:!0},placeholder:"输入文件 / 文件夹名","allow-clear":""},null,8,["modelValue"])]),_:1})])}}}),mn={class:"h-6 flex justify-start items-center"},pn={class:"hover:text-h-blue cursor-pointer"},vn=Q({__name:"file-breadcrumb",setup(I){const{breadcrumbs:x,isTree:o}=F(W()),{switchTo:b}=W(),{treeSelectedIds:_,treeData:c}=F(ne()),{itemList:h,query:d,selectedIds:m}=F(H()),{selectedIds:g}=F(ne()),{file:y}=F(pe()),r=async s=>{if(o.value){_.value=[s];const l=wt(c.value,s);l?b(l):x.value.splice(1),y.value=null}else{if(h.value.parent.id===s)return;d.value={...d.value,page:1,pid:s},m.value=[]}},w=j({get(){return o.value?c.value.length!==0&&g.value.length===ze(c.value).length:h.value.records.length!==0&&h.value.records.every(s=>m.value.includes(s.id))},set(s){s?o.value?g.value=ze(c.value):m.value=h.value.records.map(l=>l.id):m.value=g.value=[]}});return(s,l)=>{const p=Ge,$=K("icon-home"),N=Lt,B=Dt;return i(),P("div",mn,[O("label",null,[l[2]||(l[2]=k("全选 ")),t(p,{"model-value":e(w),"onUpdate:modelValue":l[0]||(l[0]=C=>Z(w)?w.value=C:null)},null,8,["model-value"])]),l[3]||(l[3]=k("  ")),t(B,{separator:"/",class:"select-none flex flex-wrap translate-y-[2px]"},{default:n(()=>[t(N,{onClick:l[1]||(l[1]=C=>r(e(x)[0].id))},{default:n(()=>[t($,{size:18,class:"hover:!text-h-blue cursor-pointer"})]),_:1}),(i(!0),P(re,null,Te(e(x).slice(1),C=>(i(),f(N,{key:C.id,onClick:S=>r(C.id)},{default:n(()=>[O("div",pn,q(C.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})])}}}),fn={class:"flex"},yn={class:"w-32"},_n=Q({__name:"file-detail-modal",setup(I){const{contextmenuType:x}=F(H()),{detail:o,isDetailModalShow:b}=F(Se()),_=oe(),c=j(()=>$t[0].children.find(m=>m.path.includes(o.value.category??"")).name),h=["无需转码","转码中","转码成功","转码失败"],d=j(()=>{var m;return[[`文件${x.value==="folder"?"夹":""}名`,o.value.name,!0],["所属用户",o.value.username,!0],["分类",c,!0],["文件类型",o.value.mediaType,!0],["状态",h[o.value.status??0],o.value.category==="video"],["歌词",(m=o.value.lyricPath)!=null&&m.length?"已上传":"未上传",o.value.category==="audio"],["创建时间",o.value.createTime,!0],["更新时间",o.value.updateTime,!0],["删除时间",o.value.deleteTime,!0],["大小",o.value.size?nt(o.value.size):"",o.value.mediaType!=="folder"],["子项数量",o.value.childNum,o.value.mediaType==="folder"]]});return(m,g)=>{const y=Tt,r=He,w=fe;return i(),f(w,{visible:e(b),"onUpdate:visible":g[0]||(g[0]=s=>Z(b)?b.value=s:null),"unmount-on-close":"",closable:!1,simple:"","hide-cancel":"",width:480},{title:n(()=>[k(q(`文件${e(x)==="folder"?"夹":""}详情`)+" ",1),(i(),f(z(e(_).FileIcons[e(o).mediaType??"folder"]),{class:"scale-150 ml-3"}))]),default:n(()=>[t(r,null,{default:n(()=>[(i(!0),P(re,null,Te(e(d),([s,l,p],$)=>(i(),P(re,{key:$},[p?(i(),f(y,{key:0},{default:n(()=>[O("div",fn,[O("div",yn,q(s)+"：",1),O("div",null,q(l),1)])]),_:2},1024)):Y("",!0)],64))),128))]),_:1})]),_:1},8,["visible"])}}}),kn={class:"flex justify-end mt-6"},gn=Q({__name:"file-share-modal",setup(I){const{show:x,sharedFiles:o}=F(Ee()),b=oe(),{config:_,formattedConfig:c}=an(),h=async()=>{if(o.value.length===0){E.warning("请选择要分享的文件");return}try{const d=await rn({ids:o.value.map(m=>m.id),...c.value});if(d.code===200){const m=location.protocol+"//"+location.host+"/share/"+d.data.shareId+(d.data.pwd?`?pwd=${d.data.pwd}`:""),g=un[_.value.expire].title;fe.info({title:"分享成功",content:()=>t(Ut,{bodyStyle:{padding:0}},{default:()=>[t("div",{class:"text-wrap"},[k("  我用hfdy云盘分享了一些文件，有效期"),_.value.value,g,k("，快来通过"),t(Et,{style:{"word-break":"break-all","white-space":"normal"},href:m,target:"_blank"},{default:()=>[m],icon:()=>t(K("icon-share-internal"),null,null)}),k("查看吧~")]),t("div",{class:"flex justify-center my-6"},[t(ge,{type:"primary",status:"success",onClick:()=>{Re(`我用hfdy云盘分享了一些文件，有效期${_.value.value}${g}，快来通过${m}查看吧~
                            `)}},{default:()=>[k("复制")]}),t(ge,{class:"ml-4",type:"primary",onClick:()=>{Re(m)}},{default:()=>[k("仅复制链接")]})])]}),footer:!1}),E.success("分享成功")}else E.error(d.message)}catch{E.error("分享失败")}};return(d,m)=>{const g=We,y=K("icon-close"),r=ge,w=Qe,s=He,l=Nt,p=zt,$=Bt,N=Vt,B=Rt,C=Mt,S=Pt,L=fe;return i(),f(L,{visible:e(x),"onUpdate:visible":m[4]||(m[4]=V=>Z(x)?x.value=V:null),title:"文件分享",footer:!1,"unmount-on-close":"",width:480},{default:n(()=>[k(" 共 "+q(e(o).length)+" 项 ",1),t(s,{data:e(o),class:"mb-5",scrollbar:"","max-height":400},{item:n(({item:V,index:A})=>[t(w,{class:"h-5 m-5"},{default:n(()=>[t(g,{span:2},{default:n(()=>[k(q(A+1),1)]),_:2},1024),t(g,{span:2},{default:n(()=>[(i(),f(z(V.mediaType==="folder"?e(b).FileIcons.folder:e(Me)(V.name)),{class:"scale-150"}))]),_:2},1024),t(g,{span:19,class:"truncate"},{default:n(()=>[k(q(V.name),1)]),_:2},1024),t(g,{span:1},{default:n(()=>[t(r,{type:"text",shape:"circle",onClick:v=>e(o).splice(A,1)},{default:n(()=>[t(y)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data"]),t(C,{model:e(_),"auto-label-width":""},{default:n(()=>[t(p,{label:"永久有效"},{default:n(()=>[t(l,{"model-value":e(_).noDdl,"onUpdate:modelValue":m[0]||(m[0]=V=>e(_).noDdl=V)},null,8,["model-value"])]),_:1}),t(p,{label:"有效期",disabled:e(_).noDdl},{default:n(()=>[t($,{min:1,max:100,modelValue:e(_).value,"onUpdate:modelValue":m[1]||(m[1]=V=>e(_).value=V)},null,8,["modelValue"])]),_:1},8,["disabled"]),t(p,{label:"单位",disabled:e(_).noDdl},{default:n(()=>[t(N,{"model-value":e(_).expire,"onUpdate:modelValue":m[2]||(m[2]=V=>e(_).expire=V),options:e(sn)},null,8,["model-value","options"])]),_:1},8,["disabled"]),t(p,{label:"提取码"},{default:n(()=>[t(B,{modelValue:e(_).pwd,"onUpdate:modelValue":m[3]||(m[3]=V=>e(_).pwd=V),modelModifiers:{trim:!0},placeholder:"不设置表示公开",allowClear:"","max-length":12},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),O("div",kn,[t(S,{content:"确认要分享的文件及信息",onOk:h},{default:n(()=>[t(r,{type:"primary",disabled:e(o).length===0},{default:n(()=>m[5]||(m[5]=[k("分享")])),_:1},8,["disabled"])]),_:1})])]),_:1},8,["visible"])}}});function lt({fileOrNode:I}){const x=I.name,o=ae(x),{editNameOp:b}=F(W()),{itemList:_}=F(H()),{filteredTreeData:c}=F(ne()),{finishCreateFolder:h,finishRename:d}=W(),m=()=>{o.value=x},g=(w,s,l)=>new Promise((p,$)=>{var N,B;o.value.trim()===x&&b.value=="change"&&$(),o.value.trim()||((N=l==null?void 0:l.fail)==null||N.call(l),b.value==="create"&&c.value.shift(),$(`文件${ie(I)?"夹":""}名不能为空`)),/[\/\\]/.test(o.value)&&((B=l==null?void 0:l.fail)==null||B.call(l),b.value==="create"&&c.value.shift(),$(`文件${ie(I)?"夹":""}名不能包含'/'和'\\'`)),w.filter(C=>C===o.value).length>1&&$("同一文件夹下的文件和文件夹不能重名"),p(o.value)}).then(async p=>{switch(b.value){case"create":return await h({name:p,pid:s,...l});case"change":await d({name:p,id:s,...l});return}}).catch(p=>{p&&E.warning(p)});return{name:o,resetName:m,handleFinishEidtInTree:(w,s)=>{const l=Ie(c.value,null,I.id);g((l==null?void 0:l.children.map(p=>p.name))??[],w,s)},handleFinishEidtInListBlock:(w,s)=>{g(_.value.records.map(l=>l.name),w,s)}}}const wn={key:0,class:"w-8 h-6"},at=Q({__name:"file-icon-name",props:{item:{},iconStyle:{},nameStyle:{},inputWidth:{}},setup(I){const x=oe(),{editingId:o,editNameOp:b,currParentFolder:_}=F(W()),{itemList:c,contextmenuItem:h,query:d}=F(H()),{clearSelected:m,updateFileItem:g}=H(),{openPreviewModal:y}=pe(),{userInfo:r}=F(Ce()),{name:w,handleFinishEidtInListBlock:s,resetName:l}=lt({fileOrNode:c.value.records.filter(v=>v.id===I.item.id)[0]}),p=j(()=>I.item.mediaType==="video"),$=j(()=>{switch(I.item.status){case le.NO_NEED:return{desc:"无需转码",comp:Kt};case le.ING:return{desc:"转码中",comp:At,color:ot,spin:!0};case le.OK:return{desc:"转码成功",comp:qt,color:"green"};case le.ERR:return{desc:"转码失败，点击重试",comp:Ot,color:"red"}}}),N=j(()=>I.item.mediaType==="folder"?x.FileIcons.folder:Me(I.item.name)),B=ye("rename_input");j(()=>{var v;return o.value&&((v=h.value)==null?void 0:v.id)===I.item.id}),Ue(()=>{var v,a;(v=B.value)==null||v.focus(),(a=B.value)==null||a.$el.querySelector("input").select()});const C=()=>{I.item.status===le.ERR&&(E.success("转码请求已提交，请耐心等待"),Ct(I.item.id),I.item.status=le.ING)},S=async()=>{if(ie(I.item)){if(we(_.value)===r.value.maxFolderLevel){E.warning("已达到最大深度，不支持打开");return}d.value={...d.value,page:1,pid:I.item.id},m()}else y(I.item)},L=()=>{const v=b.value==="create"?c.value.parent.id:h.value.id,a=b.value==="create"?{ok:g,fail:l,err:l}:{ok(){for(const T of c.value.records)T.id===I.item.id&&(T.name=w.value)},fail:l,err:l};s(v,a)},V=ae(""),A=async()=>{const v=await bt(I.item.id,new AbortController);return V.value=URL.createObjectURL(v),V.value};return(v,a)=>{const T=jt,D=Gt,M=Ye,U=en("lazy");return i(),P(re,null,[t(D,{style:se(v.iconStyle)},{content:n(()=>[e(p)?(i(),f(T,{key:0,content:e($).desc},{default:n(()=>[(i(),f(z(e($).comp),{onClick:C,size:10,spin:e($).spin,class:"cursor-pointer",style:se({color:e($).color})},null,8,["spin","style"]))]),_:1},8,["content"])):Y("",!0)]),default:n(()=>[e(St)(v.item)?tn((i(),P("img",wn,null,512)),[[U,A]]):(i(),f(z(e(N)),{key:1,class:"w-6"}))]),_:1},8,["style"]),e(o)===v.item.id?(i(),f(M,{key:0,"model-value":e(w),"onUpdate:modelValue":a[0]||(a[0]=ee=>Z(w)?w.value=ee:null),style:se({...v.nameStyle,width:`${v.inputWidth??120}px`}),ref:"rename_input",onBlur:L,onKeyup:a[1]||(a[1]=Ze(ee=>e(B).blur(),["enter"]))},null,8,["model-value","style"])):(i(),P("div",{key:1,class:"w-full truncate",style:se(v.nameStyle)},[O("span",{class:"group-hover:text-h-blue cursor-pointer hover:text-h-blue select-none",onDblclick:S},q(e(w)),33)],4))],64)}}}),st=Q({__name:"normal",setup(I){const{isDark:x,textColor:o,bgColor:b,iconColor:_}=F(oe()),{isContextmenuShow:c,editNameOp:h,layoutType:d,editingId:m,isMaxFolderLevel:g,currParentFolder:y}=F(W()),{contextmenuItem:r,contextmenuType:w,query:s,selectedFiles:l,shouldHandleGroup:p}=F(H()),{updateFileItem:$,doDelete:N,doPaste:B,prepareCreateFolder:C,prepareCut:S,prepareCopy:L,clearSelected:V}=H(),{openPreviewModal:A}=pe(),{userInfo:v}=F(Ce()),{openDetailModal:a}=Se(),{openShareFileModal:T}=Ee(),D=j(()=>Pe(x.value)),M=()=>{m.value=r.value.id,h.value="change"},U=async()=>{var G;if(w.value==="folder"){if(we(y.value)===v.value.maxFolderLevel){E.warning("已达到最大深度，不支持打开");return}s.value={...s.value,page:1,pid:(G=r.value)==null?void 0:G.id},V()}else A(r.value)},ee=async()=>{try{const G=await Oe(r.value.id);G.code===200?a(G.data):E.error(G.message)}catch{E.error("获取文件信息失败")}},ue=j(()=>p.value?l.value:[r.value]),de=ae(!1),ve=ae(!1),_e=G=>{ve.value=G,de.value=!0},be=j(()=>!p.value&&Ke(r.value)),J=ye("uploadLyric"),ke=async(G,u)=>{var R;(R=u.name)!=null&&R.endsWith(".lrc")||E.warning("只支持lyc格式的歌词文件");try{const te=new FormData;te.append("lyric",u.file),te.append("fileId",r.value.id);const ce=await qe(te);ce.code===200?(E.success("上传成功"),$()):E.error(ce.message)}catch{E.error("上传失败")}},rt=()=>{const G=p.value?l.value:[r.value];T(G)},ut=async()=>{try{E.info("下载请求已提交");const G=p.value?l.value.map(ce=>ce.id):[r.value.id],u=r.value.name,R=await Ae(G),te=document.createElement("a");te.href=URL.createObjectURL(R),te.download=p.value?"download.zip":u,te.click(),te.remove()}catch{E.error("下载失败")}};return(G,u)=>{const R=he,te=De,ce=K("icon-share-internal"),xe=Xe,dt=K("icon-copy"),ct=K("icon-paste"),mt=K("icon-music"),pt=K("icon-edit"),vt=K("icon-delete"),ft=Le,yt=fe,_t=$e;return i(),P(re,null,[t(ft,{trigger:"contextMenu",alignPoint:"",onPopupVisibleChange:u[8]||(u[8]=X=>c.value=X)},{content:n(()=>[t(xe,{title:"查看"},{default:n(()=>[e(p)?Y("",!0):(i(),f(R,{key:0,onClick:U},{default:n(()=>[(i(),f(z(e(D).open))),u[11]||(u[11]=k("  打开 "))]),_:1})),e(p)?Y("",!0):(i(),f(R,{key:1,onClick:ee},{default:n(()=>[(i(),f(z(e(D).detail))),u[12]||(u[12]=k("  详情 "))]),_:1})),t(te,{trigger:"hover"},{content:n(()=>[t(R,{onClick:u[0]||(u[0]=X=>d.value="list")},{default:n(()=>[(i(),f(z(e(D).listLayout),{style:{transform:"scale(1.4)"}})),u[13]||(u[13]=k("   列表  "))]),_:1}),t(R,{onClick:u[1]||(u[1]=X=>d.value="block")},{default:n(()=>[(i(),f(z(e(D).blockLayout))),u[14]||(u[14]=k("   方块  "))]),_:1}),t(R,{onClick:u[2]||(u[2]=X=>d.value="tree")},{default:n(()=>[(i(),f(z(e(D).treeLayout))),u[15]||(u[15]=k("   树  "))]),_:1})]),default:n(()=>[(i(),f(z(e(D).contextmenuLayout))),u[16]||(u[16]=k("  布局 "))]),_:1}),t(R,{onClick:ut},{default:n(()=>[t(e(Je)),u[17]||(u[17]=k("  下载 "))]),_:1}),t(R,{onClick:rt},{default:n(()=>[t(ce),u[18]||(u[18]=k("  分享 "))]),_:1})]),_:1}),t(xe,{title:"移动"},{default:n(()=>[t(R,{onClick:u[3]||(u[3]=X=>e(L)(e(ue)))},{default:n(()=>[t(dt),u[19]||(u[19]=k("  复制 "))]),_:1}),t(R,{onClick:u[4]||(u[4]=X=>e(S)(e(ue)))},{default:n(()=>[(i(),f(z(e(D).cut))),u[20]||(u[20]=k("  剪切 "))]),_:1}),t(R,{onClick:e(B)},{default:n(()=>[t(ct),u[21]||(u[21]=k("  粘贴 "))]),_:1},8,["onClick"])]),_:1}),t(xe,{title:"编辑"},{default:n(()=>[e(g)?Y("",!0):(i(),f(R,{key:0,onClick:e(C)},{default:n(()=>[(i(),f(z(e(D).newFolder))),u[22]||(u[22]=k("  新建文件夹  "))]),_:1},8,["onClick"])),e(be)?(i(),f(R,{key:1,onClick:u[5]||(u[5]=X=>{var Ne;return(Ne=e(J))==null?void 0:Ne.$el.click()})},{default:n(()=>[t(mt),u[23]||(u[23]=k("  上传歌词 "))]),_:1})):Y("",!0),e(p)?Y("",!0):(i(),f(R,{key:2,onClick:M},{default:n(()=>[t(pt),u[24]||(u[24]=k("  重命名 "))]),_:1})),t(R,{onClick:u[6]||(u[6]=X=>_e(!1))},{default:n(()=>[t(vt),u[25]||(u[25]=k("  删除 "))]),_:1}),t(R,{onClick:u[7]||(u[7]=X=>_e(!0))},{default:n(()=>[(i(),f(z(e(D).deleteCompletely))),u[26]||(u[26]=k("  彻底删除 "))]),_:1})]),_:1})]),default:n(()=>[et(G.$slots,"default")]),_:3}),t(yt,{visible:e(de),"onUpdate:visible":u[9]||(u[9]=X=>Z(de)?de.value=X:null),title:"提示",onOk:u[10]||(u[10]=X=>e(N)(e(ve))),"unmount-on-close":"","ok-button-props":{status:"danger"},closable:!1,width:300},{default:n(()=>[O("h2",null,q(e(ve)?"删除之后无法复原":"删除之后可在回收站找回"),1)]),_:1},8,["visible"]),t(_t,{ref:"uploadLyric",accept:".lrc",style:{display:"none"},"auto-upload":!1,onChange:ke,"show-file-list":!1},null,512)],64)}}}),it=Q({__name:"blank",setup(I){const{isMaxFolderLevel:x,layoutType:o}=F(W()),{doPaste:b,prepareCreateFolder:_}=H(),{Icons:c}=F(oe());return(h,d)=>{const m=Ht,g=K("icon-drag-arrow"),y=he,r=De,w=Le;return i(),f(w,{trigger:"contextMenu",alignPoint:""},{content:n(()=>[e(x)?Y("",!0):(i(),f(y,{key:0,onClick:e(b)},{default:n(()=>[t(g),d[3]||(d[3]=k("  粘贴 "))]),_:1},8,["onClick"])),e(x)?Y("",!0):(i(),f(y,{key:1,onClick:e(_)},{default:n(()=>[(i(),f(z(e(c).newFolder))),d[4]||(d[4]=k("  新建文件夹  "))]),_:1},8,["onClick"])),t(r,{trigger:"hover"},{content:n(()=>[t(y,{onClick:d[0]||(d[0]=s=>o.value="list")},{default:n(()=>[(i(),f(z(e(c).listLayout),{style:{transform:"scale(1.4)"}})),d[5]||(d[5]=k("  列表  "))]),_:1}),t(y,{onClick:d[1]||(d[1]=s=>o.value="block")},{default:n(()=>[(i(),f(z(e(c).blockLayout))),d[6]||(d[6]=k("  方块  "))]),_:1}),t(y,{onClick:d[2]||(d[2]=s=>o.value="tree")},{default:n(()=>[(i(),f(z(e(c).treeLayout))),d[7]||(d[7]=k("  树形  "))]),_:1})]),default:n(()=>[(i(),f(z(e(c).contextmenuLayout))),d[8]||(d[8]=k("  布局 "))]),_:1})]),default:n(()=>[t(m)]),_:1})}}}),Cn=["onContextmenu","onDblclick"],bn={class:"flex justify-end mr-3"},xn=Q({__name:"block-layout",setup(I){const{currParentFolder:x}=F(W()),{itemList:o,query:b,contextmenuItem:_,selectedIds:c,isContextmenuShow:h}=F(H()),{userInfo:d}=F(Ce()),{openPreviewModal:m}=pe(),{isDark:g}=F(oe()),y=l=>{var p;return h.value&&c.value.includes(l)&&c.value.includes(((p=_.value)==null?void 0:p.id)??"")};Wt();const r=async l=>{if(ie(l)){if(we(x.value)===d.value.maxFolderLevel){E.warning("已达到最大深度，不支持打开");return}b.value={...b.value,page:1,pid:l.id}}else m(l)},w=ae(o.value.records.reduce((l,p)=>({...l,[p.id]:c.value.some($=>$==p.id)}),{})),s=l=>{const p=c.value.findIndex($=>$===l.id);p===-1?c.value.push(l.id):c.value.splice(p,1)};return Fe(c,l=>{for(const p of o.value.records)w.value[p.id]=l.includes(p.id)}),(l,p)=>{const $=Ge,N=je,B=Qt;return e(o).records.length?(i(),f(st,{key:0},{default:n(()=>[t(N,{wrap:""},{default:n(()=>[(i(!0),P(re,null,Te(e(o).records,C=>(i(),P("div",{key:C.id,onContextmenu:S=>_.value=C,onDblclick:S=>r(C),class:nn(["w-24 h-24 m-1 flex flex-col justify-around items-center group truncate cursor-pointer rounded transition-all",`${y(C.id)?e(g)?"bg-[#333]":"bg-[#eee]":""} ${e(g)?"hover:bg-[#333]":"hover:bg-[#eee]"}`])},[t(at,{item:C,"icon-style":{transform:"scale(1.6)"},"name-style":{fontSize:"12px",textAlign:"center"},"input-width":100},null,8,["item"]),t($,{class:"-mt-3","model-value":e(w)[C.id],"onUpdate:modelValue":S=>e(w)[C.id]=S,onChange:S=>s(C)},null,8,["model-value","onUpdate:modelValue","onChange"])],42,Cn))),128))]),_:1}),O("div",bn,[t(B,{total:e(o).total,current:e(b).page,"onUpdate:current":p[0]||(p[0]=C=>e(b).page=C),"page-size":e(b).pageSize,"onUpdate:pageSize":p[1]||(p[1]=C=>e(b).pageSize=C),"show-page-size":""},null,8,["total","current","page-size"])])]),_:1})):(i(),f(it,{key:1}))}}}),Fn={class:"min-h-14 flex items-center"},In={key:1,class:"min-w-36 ml-3"},Sn={key:2,class:"w-full text-center"},$n={key:3,class:"mx-4"},hn=Q({__name:"index",props:{column:{},record:{},rowIndex:{}},setup(I){const{query:x}=F(H());return(o,b)=>(i(),P("td",null,[t(st,null,{default:n(()=>[O("div",Fn,[o.column.dataIndex==="name"?(i(),f(at,{key:0,item:o.record,"name-style":{marginLeft:"6px"},"input-width":160},null,8,["item"])):o.column.dataIndex==="updateTime"?(i(),P("div",In,q(o.record[o.column.dataIndex]),1)):o.column.dataIndex==="index"?(i(),P("div",Sn,q((e(x).page-1)*e(x).pageSize+o.rowIndex+1),1)):(i(),P("span",$n,q(o.column.dataIndex==="size"&&o.record.mediaType!=="folder"?e(nt)(o.record[o.column.dataIndex]):o.record[o.column.dataIndex]),1))])]),_:1})]))}}),Dn=Q({__name:"list-layout",setup(I){const{itemList:x,query:o,contextmenuItem:b,selectedIds:_}=F(H());on(()=>{o.value.page=1});const c=[{title:"序号",dataIndex:"index",width:60},{title:"文件名",dataIndex:"name"},{title:"修改时间",dataIndex:"updateTime",ellipsis:!0,sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:"大小",dataIndex:"size",sortable:{sortDirections:["ascend","descend"],sorter:!0}}],h=j(()=>x.value.records.map(y=>({...y,key:y.id}))??[]),d=(y,r)=>{switch(y){case"updateTime":o.value.orderByUpdateTime=r==="ascend"?me.ASC:r==="descend"?me.DESC:me.DEFAULT;break;case"size":o.value.orderBySize=r==="ascend"?me.ASC:r==="descend"?me.DESC:me.DEFAULT;break}},m=j(()=>{var y;return{total:(y=x.value)==null?void 0:y.total,current:o.value.page,pageSize:o.value.pageSize,showPageSize:!0}}),g=y=>{const{key:r,...w}=y;b.value={...w}};return(y,r)=>{const w=Yt;return i(),f(w,{columns:c,class:"my-3",scroll:{x:700},data:e(h),hoverable:"",onPageChange:r[0]||(r[0]=s=>e(o).page=s),onPageSizeChange:r[1]||(r[1]=s=>e(o).pageSize=s),pagination:e(m),"row-selection":{type:"checkbox",showCheckedAll:!0},onRowContextmenu:g,onSorterChange:d,"selected-keys":e(_),"onUpdate:selectedKeys":r[2]||(r[2]=s=>Z(_)?_.value=s:null)},{td:n(({column:s,record:l,rowIndex:p})=>[t(hn,{column:s,record:l,rowIndex:p},null,8,["column","record","rowIndex"])]),empty:n(()=>[t(it)]),_:1},8,["data","pagination","selected-keys"])}}}),Ln=Q({__name:"tree-contextmenu",props:{node:{}},setup(I){const{editingId:x,editNameOp:o,isContextmenuShow:b,layoutType:_}=F(W()),{contextmenuItem:c,selectedFiles:h,selectedIds:d}=F(ne()),{updateTreeData:m,doDelete:g}=ne(),{openDetailModal:y}=Se(),{openShareFileModal:r}=Ee(),w=oe(),s=j(()=>Pe(w.isDark)),l=()=>{x.value=c.value.id,o.value="change"},p=async()=>{try{const v=await Oe(c.value.id);v.code===200?y(v.data):E.error(v.message)}catch{E.error("获取文件信息失败")}},$=ae(!1),N=ae(!1),B=v=>{$.value=!0,N.value=v},C=ye("uploadLyric"),S=async(v,a)=>{var T;(T=a.name)!=null&&T.endsWith(".lrc")||E.warning("只支持lyc格式的歌词文件");try{const D=new FormData;D.append("lyric",a.file),D.append("fileId",c.value.id);const M=await qe(D);M.code===200?(E.success("上传成功"),m()):E.error(M.message)}catch{E.error("上传失败")}},L=j(()=>{var v;return d.value.length>1&&d.value.includes(((v=c.value)==null?void 0:v.id)??"")}),V=()=>{const v=L.value?h.value:[c.value];r(v)},A=async()=>{try{E.info("下载请求已提交");const v=L.value?h.value.map(M=>M.id):[c.value.id],a=c.value.name,T=await Ae(v),D=document.createElement("a");D.href=URL.createObjectURL(T),D.download=L.value?"download.zip":a,D.click(),D.remove()}catch{E.error("下载失败")}};return(v,a)=>{const T=he,D=De,M=K("icon-share-internal"),U=Xe,ee=K("icon-music"),ue=K("icon-edit"),de=K("icon-delete"),ve=Le,_e=fe,be=$e;return i(),P(re,null,[t(ve,{trigger:"contextMenu",alignPoint:"",onPopupVisibleChange:a[6]||(a[6]=J=>b.value=J)},{content:n(()=>[t(U,{title:"查看"},{default:n(()=>[e(L)?Y("",!0):(i(),f(T,{key:0,onClick:p},{default:n(()=>[(i(),f(z(e(s).detail))),a[9]||(a[9]=k("   详情 "))]),_:1})),t(D,{trigger:"hover"},{content:n(()=>[t(T,{onClick:a[0]||(a[0]=J=>_.value="list")},{default:n(()=>[(i(),f(z(e(s).listLayout))),a[10]||(a[10]=k("  列表  "))]),_:1}),t(T,{onClick:a[1]||(a[1]=J=>_.value="block")},{default:n(()=>[(i(),f(z(e(s).blockLayout))),a[11]||(a[11]=k("  方块  "))]),_:1}),t(T,{onClick:a[2]||(a[2]=J=>_.value="tree")},{default:n(()=>[(i(),f(z(e(s).treeLayout))),a[12]||(a[12]=k("  树形  "))]),_:1})]),default:n(()=>[(i(),f(z(e(s).contextmenuLayout))),a[13]||(a[13]=k("   布局 "))]),_:1}),t(T,{onClick:A},{default:n(()=>[t(e(Je)),a[14]||(a[14]=k("   下载 "))]),_:1}),t(T,{onClick:V},{default:n(()=>[t(M),a[15]||(a[15]=k("   分享 "))]),_:1})]),_:1}),t(U,{title:"编辑"},{default:n(()=>[e(Ke)(e(c))?(i(),f(T,{key:0,onClick:a[3]||(a[3]=J=>{var ke;return(ke=e(C))==null?void 0:ke.$el.click()})},{default:n(()=>[t(ee),a[16]||(a[16]=k("   上传歌词 "))]),_:1})):Y("",!0),e(L)?Y("",!0):(i(),f(T,{key:1,onClick:l},{default:n(()=>[t(ue),a[17]||(a[17]=k("   重命名 "))]),_:1})),t(T,{onClick:a[4]||(a[4]=J=>B(!1))},{default:n(()=>[t(de),a[18]||(a[18]=k("   删除 "))]),_:1}),t(T,{onClick:a[5]||(a[5]=J=>B(!0))},{default:n(()=>[(i(),f(z(e(s).deleteCompletely))),a[19]||(a[19]=k("   彻底删除   "))]),_:1})]),_:1})]),default:n(()=>[et(v.$slots,"default")]),_:3}),t(_e,{visible:e($),"onUpdate:visible":a[7]||(a[7]=J=>Z($)?$.value=J:null),title:"提示",width:300,onOk:a[8]||(a[8]=J=>e(g)(e(N),e(L)?e(d):[v.node.id])),"unmount-on-close":"","ok-button-props":{status:"danger"},closable:!1},{default:n(()=>[O("h2",null,q(e(N)?"删除之后无法复原":"删除之后可在回收站找回"),1)]),_:1},8,["visible"]),t(be,{ref:"uploadLyric",accept:".lrc",style:{display:"none"},"auto-upload":!1,onChange:S,"show-file-list":!1},null,512)],64)}}}),Tn=Q({__name:"tree-node-item",props:{node:{}},setup(I){var C;const{baseQuery:x,editingId:o,isContextmenuShow:b,editNameOp:_}=F(W()),{treeData:c,contextmenuItem:h,selectedIds:d}=F(ne()),{updateTreeData:m}=ne(),g=((C=Ie(c.value,null,I.node.id))==null?void 0:C.id)??"",{name:y,handleFinishEidtInTree:r,resetName:w}=lt({fileOrNode:I.node});function s(S){return x.value.keyword?S.toLowerCase().indexOf(x.value.keyword.toLowerCase()):-1}let l;const p=()=>{h.value=I.node},$=S=>{var L;return b.value&&d.value.includes(S.id)&&d.value.includes(((L=h.value)==null?void 0:L.id)??"")},N=ye("rename_input");Ue(()=>{var S,L;(S=N.value)==null||S.focus(),(L=N.value)==null||L.$el.querySelector("input").select()});const B=()=>{const S=_.value==="create"?g:I.node.id,L=_.value==="create"?{ok:m,fail:()=>Be(c.value,[I.node.id]),err:()=>Be(c.value,[I.node.id])}:{ok:()=>I.node.name=y.value,fail:w,err:w};r(S,L)};return(S,L)=>{const V=Ye;return e(o)===S.node.id?(i(),f(V,{key:0,"allow-clear":"",ref:"rename_input","model-value":e(y),"onUpdate:modelValue":L[0]||(L[0]=A=>Z(y)?y.value=A:null),onKeyup:L[1]||(L[1]=Ze(A=>e(N).blur(),["enter"])),onBlur:B},null,8,["model-value"])):(i(),f(Ln,{key:1,node:S.node},{default:n(()=>{var A,v;return[O("div",{style:se({backgroundColor:$(S.node)?"#F2F3F5":""}),class:"w-44 rounded truncate"},[(Z(l)?l.value=s(S.node.name):l=s(S.node.name),e(l)<0?(i(),P("span",{key:0,onContextmenu:p},q(S.node.name),33)):(i(),P("span",{key:1,onContextmenu:p},[O("span",null,q(S.node.name.slice(0,e(l))),1),O("span",{style:se({color:e(ot)})},q(S.node.name.slice(e(l),e(l)+((A=e(x).keyword)==null?void 0:A.length))),5),O("span",null,q(S.node.name.slice(e(l)+((v=e(x).keyword)==null?void 0:v.length))),1)],32)))],4)]}),_:1},8,["node"]))}}}),Un=Q({__name:"tree-layout",setup(I){const{userInfo:x}=F(Ce()),{breadcrumbs:o,editingId:b}=F(W()),{replaceExcludeFirst:_}=W(),{treeSelectedIds:c,treeData:h,selectedIds:d,filteredTreeData:m,treeSelectedPaths:g}=F(ne()),{updateTreeData:y,doDropCut:r,prepareCreateFolder:w}=ne(),{file:s,data:l,currentItem:p}=F(pe()),{getData:$,refreshControl:N}=pe(),{Icons:B}=F(oe()),C=ae([]);Ue(()=>{y()}),tt(()=>{const v=o.value.length;c.value=v===1?[]:[o.value[v-1].id]}),ln(()=>s.value=null);const S=v=>{C.value.includes(v)?C.value=C.value.filter(a=>a!==v):C.value.push(v)},L=async(v,{node:a})=>{const T=a,D=v[0];ie(T)?(S(T.id),_(...g.value),s.value=null):(c.value=[D],s.value={...T,updateTime:"",pid:""},_(...g.value.slice(0,-1)),N(),await $())},V=({dragNode:v,dropNode:a,dropPosition:T})=>{const D=v,M=a;if(ie(M)&&T===0)r(M.children,M.id,D),C.value.includes(M.id)||C.value.push(M.id);else{const U=Ie(h.value,null,M.id),ee=(U==null?void 0:U.children)??h.value;if(ee.some(ue=>ue.id===D.id))return;r(ee,(U==null?void 0:U.id)??"",D)}},A=v=>{C.value.push(v.id),w(v)};return(v,a)=>{const T=Jt,D=We,M=Qe;return i(),f(M,{class:"h-full"},{default:n(()=>[t(D,{flex:"300px",class:"h-full pr-1 overflow-hidden"},{default:n(()=>[t(T,{data:e(m),fieldNames:e(xt),"selected-keys":e(c),"onUpdate:selectedKeys":a[0]||(a[0]=U=>Z(c)?c.value=U:null),"expanded-keys":e(C),"onUpdate:expandedKeys":a[1]||(a[1]=U=>Z(C)?C.value=U:null),"checked-keys":e(d),"onUpdate:checkedKeys":a[2]||(a[2]=U=>Z(d)?d.value=U:null),"check-strictly":"",onSelect:L,draggable:!e(b),blockNode:"",checkable:"",onDrop:V},{title:n(U=>[t(Tn,{node:U},null,8,["node"])]),"drag-icon":n(()=>a[3]||(a[3]=[])),extra:n(U=>[e(ie)(U)&&e(b)!==U.id&&e(we)(U)<e(x).maxFolderLevel?(i(),f(z(e(B).newFolder),{key:0,onClick:ee=>A(U),class:"hover:text-h-blue"},null,8,["onClick"])):Y("",!0)]),_:1},8,["data","fieldNames","selected-keys","expanded-keys","checked-keys","draggable"])]),_:1}),t(D,{flex:"auto",class:"h-full relative overflow-hidden"},{default:n(()=>{var U;return[t(kt,{data:e(l),file:e(s),getData:e($),comp:(U=e(p))==null?void 0:U.component},null,8,["data","file","getData","comp"])]}),_:1})]),_:1})}}}),En={class:"pt-3 pr-3"},Nn={class:"h-[90%] overflow-auto pt-3"},lo=Q({__name:"index",setup(I){const{textColor:x,bgColor:o}=F(oe()),{itemList:b,query:_}=F(H()),{updateFileItem:c}=H(),{layoutType:h,isTree:d}=F(W());Fe(h,async(g,y)=>{y==="tree"&&await c()}),Xt(g=>{_.value.page=1}),j(()=>{var g;return((g=b.value.records)==null?void 0:g.map(y=>({...y,key:y.id})))??[]});let m=-1;return Fe(b,()=>{clearInterval(m),!d.value&&(m=setInterval(async()=>{const g=b.value.records.filter(r=>Ve(r)&&r.status===le.ING);if(g.length===0){clearInterval(m);return}const y=await Ft(g.map(r=>r.id));y.code===200&&(b.value.records.forEach(r=>{const w=y.data.find(s=>s.id===r.id);w&&(r.status=w.status)}),b.value.records.filter(r=>Ve(r)).every(r=>r.status===le.OK)&&clearInterval(m))},1e4))},{immediate:!0}),tt(()=>{clearInterval(m)}),(g,y)=>{const r=Zt;return i(),P("section",{class:"h-full pl-3 flex flex-col",style:se({color:e(x),backgroundColor:e(o)})},[O("div",En,[t(cn),t(vn),t(r)]),O("main",Nn,[e(h)==="list"?(i(),f(Dn,{key:0})):e(h)==="block"?(i(),f(xn,{key:1})):(i(),f(Un,{key:2}))]),t(gt),t(_n),t(gn)],4)}}});export{lo as default};
