/* empty css              *//* empty css              *//* empty css              */import{a as R}from"./file-CTjv8ooS.js";import{g as k,h as G}from"./share-BzanW0kV.js";/* empty css              */import{s as M,j as H,u as W}from"./index-CdIjDISF.js";import{d as V,aP as N,ah as X,ai as Y,o as m,an as F,ao as n,aE as b,bq as P,ap as t,aG as d,av as T,e as h,aX as S,aR as Z,a_ as L,aV as z,bx as J,ag as E,a as $,be as j,bb as Q,am as U,aY as C,bC as ee,b8 as te,ba as oe,aq as q,aZ as ae,al as se,bD as ne,bE as le,c as K,bF as re,bo as de,bg as ie,bp as ce,bw as ue,by as me,bz as pe}from"./arco-design-vue-wpZPvk8Z.js";/* empty css              */import{l as _e,t as fe,F as ve,v as ye,u as O,d as we,w as be}from"./useFolderLevelTree-BY3VF7JM.js";/* empty css              *//* empty css              */import{u as A,_ as he}from"./index.vue_vue_type_script_setup_true_lang-MDeg8KDO.js";import{c as xe}from"./calc-CYjR0slx.js";/* empty css              */import{_ as ke}from"./logo.vue_vue_type_script_setup_true_lang-GCBf-g6C.js";import"./useBreadcrumb-DDMjDaLE.js";import"./arco-design-vue-icon-S64ufJhU.js";import"./index-DeLZq7_u.js";const ge={class:"float-right mt-3"},Ie=V({__name:"file-extract-modal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(_){const l=N(_,"modelValue"),{pwd:o}=M(k()),{updateFolder:f}=k(),i=()=>f({pwdErrorCB(){o.value?b.error("提取码错误"):b.warning("请输入提取码")},okCb(){b.success("提取成功"),l.value=!1}}),y=H(),s=W();return X(()=>{o.value=y.query.pwd,i()}),Y(o,u=>{s.replace({query:{pwd:u}})}),(u,e)=>{const a=Z,v=L,p=P;return m(),F(p,{visible:l.value,"onUpdate:visible":e[1]||(e[1]=r=>l.value=r),title:"请输入提取码",footer:!1,width:480},{default:n(()=>[t(a,{modelValue:d(o),"onUpdate:modelValue":e[0]||(e[0]=r=>T(o)?o.value=r:null),allowClear:""},null,8,["modelValue"]),h("div",ge,[t(v,{type:"primary",onClick:i},{default:n(()=>e[2]||(e[2]=[S("提取")])),_:1})])]),_:1},8,["visible"])}}}),$e={class:"flex justify-end mt-6"},Fe=V({__name:"tree-modal",props:{modelValue:{type:Boolean},modelModifiers:{}},emits:["update:modelValue"],setup(_){const l=N(_,"modelValue"),{shareId:o,selectedFiles:f,selectedIds:i,contextItem:y,shouldHandleGroup:s,modalPos:u}=M(k()),{selectedIds:e,treeDataBanFileWithRoot:a,updateTreeLayerData:v}=_e();z(v);let p=!1;const r=(c,{node:w})=>{var D;const g=f.value.map(I=>I.name),B=(D=w.children)==null?void 0:D.map(I=>I.name);new Set([...g,...B]).size<g.length+B.length?(b.warning("同一目录下的文件/文件夹名不能重复"),p=!1):p=!0},x=async()=>{if(e.value.length===0){b.warning("请先选择要保存到哪个文件夹");return}if(!p){b.warning("同一目录下的文件/文件夹名不能重复");return}const c=u.value==="bottom"?s.value?i.value:[y.value.id]:i.value;try{if(!c.length){b.warning("请选择要保存的文件/文件夹");return}const w=e.value[0]===ve?"":e.value[0],g=await ye({shareId:o.value,srcIds:c,to:w});g.code===200?b.success("转存成功"):b.error(g.message)}catch{b.error("转存失败")}finally{l.value=!1}};return(c,w)=>{const g=J,B=L,D=P;return m(),F(D,{visible:l.value,"onUpdate:visible":w[2]||(w[2]=I=>l.value=I),title:"选择转存路径",footer:!1},{default:n(()=>[t(g,{data:d(a),fieldNames:d(fe),"selected-keys":d(e),"onUpdate:selectedKeys":w[0]||(w[0]=I=>T(e)?e.value=I:null),"checked-keys":d(e),"onUpdate:checkedKeys":w[1]||(w[1]=I=>T(e)?e.value=I:null),onSelect:r,"check-strictly":"",multiple:!1},null,8,["data","fieldNames","selected-keys","checked-keys"]),h("div",$e,[t(B,{type:"primary",onClick:x},{default:n(()=>w[3]||(w[3]=[S("保存")])),_:1})])]),_:1},8,["visible"])}}}),Ce={class:"flex justify-around items-center px-2"},Ve={class:"text-lg"},Se={class:"my-2"},Me={class:"my-2"},Te={class:"flex flex-col"},Be=V({__name:"index",setup(_){const{sharedFiles:l,treeModalShow:o,modalPos:f}=M(k()),i=E(!1);return(y,s)=>{const u=ee,e=te,a=oe,v=Q,p=U("icon-save"),r=L,x=U("icon-link");return m(),$(j,null,[h("div",Ce,[t(v,{bordered:!1},{default:n(()=>[t(a,{class:"list-demo-item","action-layout":"vertical"},{default:n(()=>[t(e,null,{title:n(()=>[h("span",Ve," 分享者："+C(d(l).username),1)]),description:n(()=>[h("div",Se,"创建时间： "+C(d(l).createTime),1),h("div",Me,"围观次数： "+C(d(l).visitNum),1)]),avatar:n(()=>[t(u,{"image-url":d(l).avatar,class:"scale-[2.2] mr-6"},null,8,["image-url"])]),_:1})]),_:1})]),_:1}),h("div",Te,[t(r,{type:"primary",class:"my-3",onClick:s[0]||(s[0]=c=>{f.value="top",o.value=!0})},{icon:n(()=>[t(p)]),default:n(()=>[s[4]||(s[4]=S("转存 "))]),_:1}),t(r,{type:"primary",status:"success",onClick:s[1]||(s[1]=c=>i.value=!0)},{icon:n(()=>[t(x)]),default:n(()=>[s[5]||(s[5]=S("提取 "))]),_:1})])]),t(Fe,{modelValue:d(o),"onUpdate:modelValue":s[2]||(s[2]=c=>T(o)?o.value=c:null)},null,8,["modelValue"]),t(Ie,{modelValue:d(i),"onUpdate:modelValue":s[3]||(s[3]=c=>T(i)?i.value=c:null)},null,8,["modelValue"])],64)}}}),Ue=V({__name:"context-menu",setup(_){const{shouldHandleGroup:l,contextItem:o,selectedIds:f,treeModalShow:i,modalPos:y}=M(k()),{updateFolder:s}=k(),{openPreviewModal:u}=A(),e=O(),a=async()=>{R(o.value)?(f.value=[],await s({pid:o.value.id})):u(o.value)},v=async()=>{try{b.info("下载请求已提交");const p=l.value?f.value:[o.value.id],r=p.length>1?"download.zip":o.value.name,x=await G(p),c=document.createElement("a");c.href=URL.createObjectURL(x),c.download=r,c.click(),c.remove()}catch{b.error("下载失败")}};return(p,r)=>{const x=ne,c=U("icon-save"),w=U("icon-download"),g=le;return m(),F(g,{trigger:"contextMenu",alignPoint:""},{content:n(()=>[d(l)?ae("",!0):(m(),F(x,{key:0,onClick:a},{default:n(()=>[(m(),F(q(d(e).Icons.open))),r[1]||(r[1]=S(" 打开   "))]),_:1})),t(x,{onClick:r[0]||(r[0]=B=>{y.value="bottom",i.value=!0})},{default:n(()=>[t(c),r[2]||(r[2]=S(" 转存 "))]),_:1}),t(x,{onClick:v},{default:n(()=>[t(w),r[3]||(r[3]=S(" 下载 "))]),_:1})]),default:n(()=>[se(p.$slots,"default")]),_:3})}}}),De={class:"min-h-14 flex items-center"},Re={key:0,class:"flex justify-start items-center"},Le={key:1,class:"min-w-36 ml-3"},Ne={key:2,class:"w-full text-center"},Pe={key:3,class:"mx-4"},ze=V({__name:"table-cell",props:{column:{},record:{},rowIndex:{}},setup(_){const{selectedIds:l,shareId:o}=M(k()),{updateFolder:f}=k(),{openPreviewModal:i}=A(),y=O(),s=K(()=>R(_.record)?y.FileIcons.folder:we(_.record.name)),u=async()=>{R(_.record)?(l.value=[],await f({pid:_.record.id})):await i(_.record)},e=E("");return z(async()=>{if(_.record.category!=="image")return;const a=await be(_.record.id,new AbortController,o.value);e.value=URL.createObjectURL(a)}),(a,v)=>{const p=re;return m(),$("td",null,[t(Ue,null,{default:n(()=>[h("div",De,[a.column.dataIndex==="name"?(m(),$("div",Re,[d(e)?(m(),F(p,{key:0,src:d(e),width:30,height:30},null,8,["src"])):(m(),F(q(d(s)),{key:1,class:"scale-150"})),h("span",{class:"cursor-pointer hover:text-h-blue select-none ml-3",onDblclick:u},C(a.record.name),33)])):a.column.dataIndex==="updateTime"?(m(),$("div",Le,C(a.record.updateTime),1)):a.column.dataIndex==="index"?(m(),$("div",Ne,C(a.rowIndex+1),1)):(m(),$("span",Pe,C(a.column.dataIndex==="size"&&a.record.mediaType!=="folder"?d(xe)(a.record.size):a.record.size),1))])]),_:1})])}}}),Ee={class:"hover:text-h-blue cursor-pointer"},je=V({__name:"breadcrumb",setup(_){const{breadcrumbs:l,sharedFiles:o}=M(k()),{updateFolder:f}=k(),i=async y=>{o.value.parent.id!==y&&await f({pid:y})};return(y,s)=>{const u=U("icon-home"),e=ce,a=de;return m(),F(a,{separator:">",class:"select-none flex flex-wrap"},{default:n(()=>[t(e,{onClick:s[0]||(s[0]=v=>i(d(l)[0].id))},{default:n(()=>[t(u,{size:18,class:"hover:text-h-blue cursor-pointer"})]),_:1}),(m(!0),$(j,null,ie(d(l).slice(1),v=>(m(),F(e,{key:v.id,onClick:p=>i(v.id)},{default:n(()=>[h("div",Ee,C(v.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})}}}),qe={class:"h-full overflow-auto"},Ke=V({__name:"index",setup(_){const{contextItem:l,sharedFiles:o,selectedIds:f}=M(k()),i=K(()=>{var u;return((u=o.value.records)==null?void 0:u.map(e=>({...e,key:e.id})))??[]}),y=u=>{const{key:e,...a}=u;l.value={...a}},s=[{title:"序号",dataIndex:"index",width:60},{title:"文件名",dataIndex:"name"},{title:"修改时间",dataIndex:"updateTime"},{title:"大小",dataIndex:"size"}];return(u,e)=>{const a=ue,v=pe,p=me;return m(),$("section",qe,[t(a),t(je),t(p,{columns:s,class:"mt-3 mr-3",data:d(i),hoverable:"",pagination:!1,scroll:{x:700},onRowContextmenu:y,"row-selection":{type:"checkbox",showCheckedAll:!0},selectedKeys:d(f),"onUpdate:selectedKeys":e[0]||(e[0]=r=>T(f)?f.value=r:null)},{td:n(({column:r,record:x,rowIndex:c})=>[t(ze,{column:r,record:x,rowIndex:c},null,8,["column","record","rowIndex"])]),empty:n(()=>[t(v,{description:"还没有任何文件~"})]),_:1},8,["data","selectedKeys"]),t(he)])}}}),Oe={class:"py-3"},Ae={class:"flex justify-center"},Ge={class:"pl-3"},mt=V({__name:"index",setup(_){return document.title="分享文件",(l,o)=>(m(),$("div",Oe,[h("div",Ae,[t(ke,{"hide-title":!1})]),t(Be),h("div",Ge,[t(Ke)])]))}});export{mt as default};
