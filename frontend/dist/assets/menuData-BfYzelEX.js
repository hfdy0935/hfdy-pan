import{T as j,u as J,i as V,l as K,m as W,n as X,o as Y,p as Z,q as k,s as ee}from"./useFolderLevelTree-BY3VF7JM.js";import{a as G,b as H,d as ae}from"./calc-CYjR0slx.js";import{u as te}from"./useBreadcrumb-DDMjDaLE.js";import{a as O,c as se,b as oe}from"./file-CTjv8ooS.js";import{ag as v,c as g,ai as B,aE as r,ap as F,ac as le,a9 as re,ad as ne,O as ce,S as ie}from"./arco-design-vue-wpZPvk8Z.js";import{i as x,s as q,a as $,j as ue}from"./index-CdIjDISF.js";import{d as de,e as pe,f as me,g as ve,h as he}from"./arco-design-vue-icon-S64ufJhU.js";var U=(s=>(s[s.DEFAULT=-1]="DEFAULT",s[s.ASC=1]="ASC",s[s.DESC=0]="DESC",s))(U||{});function Q(){const s=v([]),n=()=>{s.value=[]},c=v(null),S=g(()=>c.value===null?null:O(c.value)?"folder":"file");return{selectedIds:s,contextmenuItem:c,contextmenuType:S,clearSelected:n}}const z=x("baseFileStore",()=>{const{userInfo:s}=q($()),{updateUserInfo:n}=$(),{breadcrumbs:c,switchTo:S,replaceExcludeFirst:D}=te(),y=g(()=>c.value[c.value.length-1]),T=v("block"),E=g(()=>T.value==="tree"),w=g(()=>se(y.value)>=s.value.maxFolderLevel),I=v(""),f=v("change"),C=v(!1),b=v({keyword:""});return{breadcrumbs:c,switchTo:S,replaceExcludeFirst:D,currParentFolder:y,isMaxFolderLevel:w,layoutType:T,isTree:E,editingId:I,editNameOp:f,isContextmenuShow:C,baseQuery:b,prepareEditName:(h,m)=>{I.value=h,f.value=m},finishCreateFolder:async({pid:h,name:m,ok:e,fail:a,err:o})=>{try{const l=await W({pid:h,name:m});l.code===200?(r.success("创建成功"),e==null||e()):(r.error(l.message),a==null||a())}catch{r.error("创建失败"),o==null||o()}finally{I.value=""}},finishRename:async({id:h,name:m,ok:e,fail:a,err:o})=>{try{const l=await X({id:h,name:m});l.code===200?(r.success("修改成功"),e==null||e()):(r.error(l.message),a==null||a())}catch{r.error("修改失败"),o==null||o()}finally{I.value=""}},deleteFiles:async({completely:h,ids:m,ok:e,fail:a,err:o})=>{try{const l=await Y(m,h);l.code===200?(r.success("删除成功"),e==null||e(),n()):(r.error(l.message),a==null||a())}catch{r.error("删除失败"),o==null||o()}},pasteFiles:async({peers:h,targetId:m,ok:e,fail:a,err:o,op:l,filesNeedMove:i})=>{if(!i.length){r.info("请先选择要复制/剪切的文件/文件夹");return}const L=h.map(t=>t.name),P=i.map(t=>t.name);if(new Set([...L,...P]).size!==L.length+P.length){r.warning("文件/文件夹名不能和目标文件夹下的文件/文件夹重复");return}const R=l==="copy"?"复制":"移动";try{const t=await Z({idList:i.map(u=>u.id),targetId:m,op:l});t.code===200?(r.success(`${R}成功`),e==null||e(),i=[],n()):(r.error(t.message),a==null||a())}catch{r.error(`${R}失败`),o==null||o()}}}}),De=x("fileItemStore",()=>{const s=ue(),{selectedIds:n,contextmenuItem:c,contextmenuType:S,clearSelected:D}=Q(),y=g(()=>p.value.records.filter(t=>n.value.includes(t.id))),{breadcrumbs:T,isContextmenuShow:E,baseQuery:w,isTree:I,isMaxFolderLevel:f}=q(z()),{switchTo:C,prepareEditName:b,deleteFiles:A,pasteFiles:N}=z(),d=v({category:"all",page:1,pageSize:10,pid:"",orderByUpdateTime:U.DEFAULT,orderBySize:U.DEFAULT}),p=v({total:0,parent:{id:"",name:" ",updateTime:"",pid:"",level:"",category:"all",mediaType:"folder",status:j.NO_NEED,lyricPath:""},records:[],category:"all",page:d.value.page,pageSize:d.value.pageSize,keyword:(w==null?void 0:w.value.keyword)??"",orderByUpdateTime:U.DEFAULT,orderBySize:U.DEFAULT}),M=g(()=>p.value.records.filter(O)),h=g(()=>p.value.records.filter(oe));B(T,t=>d.value.pid=t[t.length-1].id);const m=async t=>{try{const u=await k({...d.value,...w.value,...t||{}});if(u.code===200)return p.value=u.data,C(u.data.parent),!0;r.error("获取文件失败 "+(u.message??""))}catch{r.error("获取文件失败")}};B([()=>d.value.category,()=>d.value.page,()=>d.value.pid,()=>d.value.pageSize,()=>d.value.orderByUpdateTime,()=>d.value.orderBySize],()=>{!I.value&&m()},{immediate:!0}),B(()=>s.params.category,t=>{D(),t&&(d.value.category=t)}),B(w,()=>{I.value||m()},{deep:!0});const e=g(()=>y.value.length>1&&y.value.some(t=>{var u;return t.id===((u=c.value)==null?void 0:u.id)})),a=async()=>{if(f.value){r.warning("创建失败，已达到最大深度");return}const t={id:G(p.value.records.map(u=>u.id)),name:H(p.value.records.map(u=>u.name)),updateTime:ae(),mediaType:"folder"};b(t.id,"create"),p.value.records.unshift(t)},o=async t=>{const u=e.value?y.value.map(_=>_.id):[c.value.id];A({completely:t,ids:u,ok(){p.value.records=p.value.records.filter(_=>!u.includes(_.id))}})},l=v("copy"),i=v([]);return{selectedIds:n,selectedFiles:y,contextmenuItem:c,contextmenuType:S,isContextmenuShow:E,clearSelected:D,query:d,itemList:p,folderList:M,fileList:h,updateFileItem:m,shouldHandleGroup:e,prepareCreateFolder:a,doDelete:o,filesNeedMove:i,prepareCut:t=>{l.value="cut",i.value=t},prepareCopy:t=>{l.value="copy",i.value=t},doPaste:async()=>{N({peers:p.value.records,targetId:p.value.parent.id,ok:()=>{m(),i.value=[]},op:l.value,filesNeedMove:i.value})}}}),Te=x("fileNodeStore",()=>{const{selectedIds:s,contextmenuItem:n,contextmenuType:c}=Q(),{FileIcons:S}=q(J()),{baseQuery:D,breadcrumbs:y}=q(z()),T=g(()=>s.value.map(e=>V(f.value,e)).filter(e=>e!==null)),{prepareEditName:E,deleteFiles:w,pasteFiles:I}=z(),{treeDataAllowFile:f,rawLevel:C,selectedIds:b,selectedPaths:A,updateTreeLayerData:N}=K();function d(e){const a=o=>{const l=[];return o.forEach(i=>{if(i.name.toLowerCase().includes(e.toLowerCase()))l.push({...i});else if(i.children){const L=a(i.children);L.length&&l.push({...i,children:L})}}),l};return a(f.value)}const p=g(()=>D.value.keyword?d(D.value.keyword):f.value);return{treeData:f,rawTreeData:C,treeSelectedIds:b,treeSelectedPaths:A,updateTreeData:N,selectedIds:s,selectedFiles:T,contextmenuItem:n,contextmenuType:c,filteredTreeData:p,prepareCreateFolder:e=>{const a=e??V(f.value,y.value[y.value.length-1].id)??{children:f.value},o={id:G(a.children.map(l=>l.id)),name:H(a.children.map(l=>l.name)),children:[],level:"",status:j.NO_NEED,category:"all",mediaType:"folder",icon:()=>S.value.folder,disabled:!1,lyricPath:""};E(o.id,"create"),a.children.unshift(o)},doDelete:async(e,a)=>{w({completely:e,ids:a,ok(){ee(C.value,a)}})},doDropCut:(e,a,o)=>{I({peers:e,targetId:a,op:"cut",filesNeedMove:[o],ok:N})}}}),Ce=x("uploadFileStore",()=>{const s=v([]),n=v([]);return{uploadFileList:s,uploadedFileUidList:n}}),Le=x("fileDetailStore",()=>{const s=v({}),n=v(!1);return{detail:s,isDetailModalShow:n,openDetailModal:S=>{s.value=S,n.value=!0}}});function Ee(s){navigator.clipboard.writeText(s).then(()=>{r.success("复制成功")}).catch(n=>{r.error("复制失败")})}function be(s,n=2e3){let c=0;return function(){clearTimeout(c),c=setTimeout(()=>s(),n)}}const Ne=[{id:"0",name:"首页",icon:F(de,null,null),path:"/file/all",isShow:!0,children:[{id:"0",name:"全部",icon:F(pe,null,null),path:"/file/all",isShow:!0},{id:"1",name:"视频",icon:F(le,null,null),path:"/file/video",isShow:!0,category:"video"},{id:"2",name:"音频",icon:F(re,null,null),path:"/file/audio",isShow:!0,category:"audio"},{id:"3",name:"图片",icon:F(me,null,null),path:"/file/image",isShow:!0,category:"image"},{id:"4",name:"文档",icon:F(ne,null,null),path:"/file/docs",isShow:!0,category:"docs"},{id:"5",name:"其他",icon:F(ce,null,null),path:"/file/others",isShow:!0,category:"others"}]},{id:"1",name:"分享",icon:F(ve,null,null),path:"/share",isShow:!0},{id:"2",name:"回收站",icon:F(ie,null,null),path:"/recycle",tips:"回收站为你保存10天内删除的文件",isShow:!0},{id:"3",name:"管理",icon:F(he,null,null),path:"/admin",isShow:!0}];export{U as O,De as a,Te as b,Ce as c,be as d,Le as e,Ee as f,Ne as m,z as u};
